{
  "hash": "54fe1121db9da83d63a7f100b5978270",
  "result": {
    "markdown": "---\ntitle: 需要モデルの推定（応用編）\nformat:\n  html:\n    toc: true\n    html-math-method: katex\n---\n\n::: {.cell execution_count=1}\n``` {.julia .cell-code}\nusing CSV\nusing DataFrames\nusing StringEncodings\nusing FixedEffectModels\nusing RegressionTables\nusing Plots\nusing LinearAlgebra\nusing Statistics\nusing Optim\nusing Printf\nusing ForwardDiff\nusing Random\nusing GLM\nusing Serialization\n```\n:::\n\n\n::: {.cell execution_count=2}\n``` {.julia .cell-code}\ndata = CSV.read(\"data/demand_estimation_merger/chap3_data.csv\", DataFrame);\nfirst(data, 5)\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div><div style = \"float: left;\"><span>5×61 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">NameID</th><th style = \"text-align: left;\">year</th><th style = \"text-align: left;\">Maker</th><th style = \"text-align: left;\">Type</th><th style = \"text-align: left;\">Name</th><th style = \"text-align: left;\">Sales</th><th style = \"text-align: left;\">Model</th><th style = \"text-align: left;\">price</th><th style = \"text-align: left;\">kata</th><th style = \"text-align: left;\">FuelEfficiency</th><th style = \"text-align: left;\">capacity</th><th style = \"text-align: left;\">FuelType</th><th style = \"text-align: left;\">HH</th><th style = \"text-align: left;\">size</th><th style = \"text-align: left;\">hppw</th><th style = \"text-align: left;\">share</th><th style = \"text-align: left;\">share0</th><th style = \"text-align: left;\">hppw_sum_own</th><th style = \"text-align: left;\">FuelEfficiency_sum_own</th><th style = \"text-align: left;\">size_sum_own</th><th style = \"text-align: left;\">hppw_sqr_sum_own</th><th style = \"text-align: left;\">FuelEfficiency_sqr_sum_own</th><th style = \"text-align: left;\">size_sqr_sum_own</th><th style = \"text-align: left;\">hppw_sum_mkt</th><th style = \"text-align: left;\">FuelEfficiency_sum_mkt</th><th style = \"text-align: left;\">size_sum_mkt</th><th style = \"text-align: left;\">hppw_sqr_sum_mkt</th><th style = \"text-align: left;\">FuelEfficiency_sqr_sum_mkt</th><th style = \"text-align: left;\">size_sqr_sum_mkt</th><th style = \"text-align: left;\">iv_BLP_own_hppw</th><th style = \"text-align: left;\">iv_BLP_own_FuelEfficiency</th><th style = \"text-align: left;\">iv_BLP_own_size</th><th style = \"text-align: left;\">iv_BLP_other_hppw</th><th style = \"text-align: left;\">iv_BLP_other_FuelEfficiency</th><th style = \"text-align: left;\">iv_BLP_other_size</th><th style = \"text-align: left;\">iv_BLP_own_num</th><th style = \"text-align: left;\">iv_BLP_other_num</th><th style = \"text-align: left;\">iv_GH_own_hppw</th><th style = \"text-align: left;\">iv_GH_own_FuelEfficiency</th><th style = \"text-align: left;\">iv_GH_own_size</th><th style = \"text-align: left;\">iv_GH_other_hppw</th><th style = \"text-align: left;\">iv_GH_other_FuelEfficiency</th><th style = \"text-align: left;\">iv_GH_other_size</th><th style = \"text-align: left;\">logit_share</th><th style = \"text-align: left;\">iv_BLP_own_hppw_nest</th><th style = \"text-align: left;\">iv_BLP_own_FuelEfficiency_nest</th><th style = \"text-align: left;\">iv_BLP_own_size_nest</th><th style = \"text-align: left;\">iv_BLP_other_hppw_nest</th><th style = \"text-align: left;\">iv_BLP_other_FuelEfficiency_nest</th><th style = \"text-align: left;\">iv_BLP_other_size_nest</th><th style = \"text-align: left;\">iv_BLP_own_num_nest</th><th style = \"text-align: left;\">iv_BLP_other_num_nest</th><th style = \"text-align: left;\">iv_GH_own_hppw_nest</th><th style = \"text-align: left;\">iv_GH_own_FuelEfficiency_nest</th><th style = \"text-align: left;\">iv_GH_own_size_nest</th><th style = \"text-align: left;\">iv_GH_other_hppw_nest</th><th style = \"text-align: left;\">iv_GH_other_FuelEfficiency_nest</th><th style = \"text-align: left;\">iv_GH_other_size_nest</th><th style = \"text-align: left;\">sum_year_body</th><th style = \"text-align: left;\">inside_share</th><th style = \"text-align: left;\">log_inside_share</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"String15\" style = \"text-align: left;\">String15</th><th title = \"String7\" style = \"text-align: left;\">String7</th><th title = \"String31\" style = \"text-align: left;\">String31</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"String15\" style = \"text-align: left;\">String15</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"String15\" style = \"text-align: left;\">String15</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Int64\" style = \"text-align: left;\">Int64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: right;\">14</td><td style = \"text-align: right;\">2011</td><td style = \"text-align: left;\">Audi</td><td style = \"text-align: left;\">Foreign</td><td style = \"text-align: left;\">A1シリーズ</td><td style = \"text-align: right;\">4206</td><td style = \"text-align: left;\">1.4 TFSI</td><td style = \"text-align: right;\">2.99804</td><td style = \"text-align: left;\">DBA-8XCAX</td><td style = \"text-align: right;\">19.4</td><td style = \"text-align: right;\">4</td><td style = \"text-align: left;\">ハイオク</td><td style = \"text-align: right;\">53783435</td><td style = \"text-align: right;\">9.94723</td><td style = \"text-align: right;\">0.102521</td><td style = \"text-align: right;\">7.82025e-5</td><td style = \"text-align: right;\">0.938981</td><td style = \"text-align: right;\">0.299061</td><td style = \"text-align: right;\">49.4</td><td style = \"text-align: right;\">33.1397</td><td style = \"text-align: right;\">0.0299428</td><td style = \"text-align: right;\">831.48</td><td style = \"text-align: right;\">369.074</td><td style = \"text-align: right;\">1.93875</td><td style = \"text-align: right;\">276.2</td><td style = \"text-align: right;\">218.564</td><td style = \"text-align: right;\">0.207044</td><td style = \"text-align: right;\">4206.04</td><td style = \"text-align: right;\">2550.97</td><td style = \"text-align: right;\">0.19654</td><td style = \"text-align: right;\">30.0</td><td style = \"text-align: right;\">23.1925</td><td style = \"text-align: right;\">15.7229</td><td style = \"text-align: right;\">2464.5</td><td style = \"text-align: right;\">1811.61</td><td style = \"text-align: right;\">2</td><td style = \"text-align: right;\">157</td><td style = \"text-align: right;\">0.000154423</td><td style = \"text-align: right;\">43.84</td><td style = \"text-align: right;\">6.61965</td><td style = \"text-align: right;\">0.216315</td><td style = \"text-align: right;\">5703.33</td><td style = \"text-align: right;\">1332.33</td><td style = \"text-align: right;\">-9.39325</td><td style = \"text-align: right;\">0.19654</td><td style = \"text-align: right;\">30.0</td><td style = \"text-align: right;\">23.1925</td><td style = \"text-align: right;\">1.63969</td><td style = \"text-align: right;\">226.8</td><td style = \"text-align: right;\">185.424</td><td style = \"text-align: right;\">2</td><td style = \"text-align: right;\">16</td><td style = \"text-align: right;\">0.000154423</td><td style = \"text-align: right;\">43.84</td><td style = \"text-align: right;\">6.61965</td><td style = \"text-align: right;\">0.00906462</td><td style = \"text-align: right;\">596.48</td><td style = \"text-align: right;\">76.1391</td><td style = \"text-align: right;\">143357</td><td style = \"text-align: right;\">0.0293393</td><td style = \"text-align: right;\">-3.52883</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: right;\">14</td><td style = \"text-align: right;\">2012</td><td style = \"text-align: left;\">Audi</td><td style = \"text-align: left;\">Foreign</td><td style = \"text-align: left;\">A1シリーズ</td><td style = \"text-align: right;\">4502</td><td style = \"text-align: left;\">1.4 TFSI</td><td style = \"text-align: right;\">2.835</td><td style = \"text-align: left;\">DBA-8XCAX</td><td style = \"text-align: right;\">19.4</td><td style = \"text-align: right;\">4</td><td style = \"text-align: left;\">ハイオク</td><td style = \"text-align: right;\">54171475</td><td style = \"text-align: right;\">9.94723</td><td style = \"text-align: right;\">0.102521</td><td style = \"text-align: right;\">8.31065e-5</td><td style = \"text-align: right;\">0.919762</td><td style = \"text-align: right;\">0.309984</td><td style = \"text-align: right;\">49.8</td><td style = \"text-align: right;\">33.1791</td><td style = \"text-align: right;\">0.0323769</td><td style = \"text-align: right;\">842.36</td><td style = \"text-align: right;\">370.051</td><td style = \"text-align: right;\">1.83969</td><td style = \"text-align: right;\">298.3</td><td style = \"text-align: right;\">215.509</td><td style = \"text-align: right;\">0.182524</td><td style = \"text-align: right;\">4896.57</td><td style = \"text-align: right;\">2484.02</td><td style = \"text-align: right;\">0.207463</td><td style = \"text-align: right;\">30.4</td><td style = \"text-align: right;\">23.2319</td><td style = \"text-align: right;\">16.1851</td><td style = \"text-align: right;\">2659.3</td><td style = \"text-align: right;\">1891.36</td><td style = \"text-align: right;\">2</td><td style = \"text-align: right;\">164</td><td style = \"text-align: right;\">0.000348865</td><td style = \"text-align: right;\">39.2</td><td style = \"text-align: right;\">6.8118</td><td style = \"text-align: right;\">0.22062</td><td style = \"text-align: right;\">6457.49</td><td style = \"text-align: right;\">1428.51</td><td style = \"text-align: right;\">-9.31175</td><td style = \"text-align: right;\">0.207463</td><td style = \"text-align: right;\">30.4</td><td style = \"text-align: right;\">23.2319</td><td style = \"text-align: right;\">1.5297</td><td style = \"text-align: right;\">248.5</td><td style = \"text-align: right;\">182.33</td><td style = \"text-align: right;\">2</td><td style = \"text-align: right;\">16</td><td style = \"text-align: right;\">0.000348865</td><td style = \"text-align: right;\">39.2</td><td style = \"text-align: right;\">6.8118</td><td style = \"text-align: right;\">0.00466326</td><td style = \"text-align: right;\">434.17</td><td style = \"text-align: right;\">69.7742</td><td style = \"text-align: right;\">159210</td><td style = \"text-align: right;\">0.0282771</td><td style = \"text-align: right;\">-3.5657</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: right;\">14</td><td style = \"text-align: right;\">2013</td><td style = \"text-align: left;\">Audi</td><td style = \"text-align: left;\">Foreign</td><td style = \"text-align: left;\">A1シリーズ</td><td style = \"text-align: right;\">5071</td><td style = \"text-align: left;\">1.4 TFSI</td><td style = \"text-align: right;\">2.82326</td><td style = \"text-align: left;\">DBA-8XCAX</td><td style = \"text-align: right;\">19.4</td><td style = \"text-align: right;\">4</td><td style = \"text-align: left;\">ハイオク</td><td style = \"text-align: right;\">54594744</td><td style = \"text-align: right;\">9.94723</td><td style = \"text-align: right;\">0.102521</td><td style = \"text-align: right;\">9.28844e-5</td><td style = \"text-align: right;\">0.919563</td><td style = \"text-align: right;\">0.311828</td><td style = \"text-align: right;\">52.7</td><td style = \"text-align: right;\">33.5456</td><td style = \"text-align: right;\">0.0327145</td><td style = \"text-align: right;\">947.05</td><td style = \"text-align: right;\">378.12</td><td style = \"text-align: right;\">1.95986</td><td style = \"text-align: right;\">334.4</td><td style = \"text-align: right;\">228.399</td><td style = \"text-align: right;\">0.196626</td><td style = \"text-align: right;\">5760.2</td><td style = \"text-align: right;\">2656.1</td><td style = \"text-align: right;\">0.209307</td><td style = \"text-align: right;\">33.3</td><td style = \"text-align: right;\">23.5983</td><td style = \"text-align: right;\">15.5385</td><td style = \"text-align: right;\">2762.2</td><td style = \"text-align: right;\">1857.63</td><td style = \"text-align: right;\">2</td><td style = \"text-align: right;\">161</td><td style = \"text-align: right;\">0.000308215</td><td style = \"text-align: right;\">31.37</td><td style = \"text-align: right;\">7.59138</td><td style = \"text-align: right;\">0.201628</td><td style = \"text-align: right;\">6612.26</td><td style = \"text-align: right;\">1400.56</td><td style = \"text-align: right;\">-9.2003</td><td style = \"text-align: right;\">0.209307</td><td style = \"text-align: right;\">33.3</td><td style = \"text-align: right;\">23.5983</td><td style = \"text-align: right;\">1.64803</td><td style = \"text-align: right;\">281.7</td><td style = \"text-align: right;\">194.853</td><td style = \"text-align: right;\">2</td><td style = \"text-align: right;\">17</td><td style = \"text-align: right;\">0.000308215</td><td style = \"text-align: right;\">31.37</td><td style = \"text-align: right;\">7.59138</td><td style = \"text-align: right;\">0.00467482</td><td style = \"text-align: right;\">281.31</td><td style = \"text-align: right;\">83.5873</td><td style = \"text-align: right;\">191874</td><td style = \"text-align: right;\">0.0264288</td><td style = \"text-align: right;\">-3.6333</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: right;\">15</td><td style = \"text-align: right;\">2006</td><td style = \"text-align: left;\">Audi</td><td style = \"text-align: left;\">Foreign</td><td style = \"text-align: left;\">A3シリーズ</td><td style = \"text-align: right;\">4830</td><td style = \"text-align: left;\">アトラクション</td><td style = \"text-align: right;\">2.91889</td><td style = \"text-align: left;\">GH-8PBSE</td><td style = \"text-align: right;\">12.2</td><td style = \"text-align: right;\">5</td><td style = \"text-align: left;\">ハイオク</td><td style = \"text-align: right;\">51102005</td><td style = \"text-align: right;\">10.8151</td><td style = \"text-align: right;\">0.075</td><td style = \"text-align: right;\">9.45168e-5</td><td style = \"text-align: right;\">0.915228</td><td style = \"text-align: right;\">0.163435</td><td style = \"text-align: right;\">23.4</td><td style = \"text-align: right;\">22.4202</td><td style = \"text-align: right;\">0.0134458</td><td style = \"text-align: right;\">274.28</td><td style = \"text-align: right;\">251.645</td><td style = \"text-align: right;\">1.97874</td><td style = \"text-align: right;\">224.8</td><td style = \"text-align: right;\">231.473</td><td style = \"text-align: right;\">0.207998</td><td style = \"text-align: right;\">2577.22</td><td style = \"text-align: right;\">2715.96</td><td style = \"text-align: right;\">0.0884354</td><td style = \"text-align: right;\">11.2</td><td style = \"text-align: right;\">11.6051</td><td style = \"text-align: right;\">16.1609</td><td style = \"text-align: right;\">2391.0</td><td style = \"text-align: right;\">1840.9</td><td style = \"text-align: right;\">1</td><td style = \"text-align: right;\">163</td><td style = \"text-align: right;\">0.000180509</td><td style = \"text-align: right;\">1.0</td><td style = \"text-align: right;\">0.624049</td><td style = \"text-align: right;\">0.255313</td><td style = \"text-align: right;\">4557.36</td><td style = \"text-align: right;\">1004.29</td><td style = \"text-align: right;\">-9.17815</td><td style = \"text-align: right;\">0.0884354</td><td style = \"text-align: right;\">11.2</td><td style = \"text-align: right;\">11.6051</td><td style = \"text-align: right;\">1.81531</td><td style = \"text-align: right;\">201.4</td><td style = \"text-align: right;\">209.053</td><td style = \"text-align: right;\">1</td><td style = \"text-align: right;\">18</td><td style = \"text-align: right;\">0.000180509</td><td style = \"text-align: right;\">1.0</td><td style = \"text-align: right;\">0.624049</td><td style = \"text-align: right;\">0.023506</td><td style = \"text-align: right;\">67.9</td><td style = \"text-align: right;\">47.8497</td><td style = \"text-align: right;\">169488</td><td style = \"text-align: right;\">0.0284976</td><td style = \"text-align: right;\">-3.55794</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: right;\">15</td><td style = \"text-align: right;\">2007</td><td style = \"text-align: left;\">Audi</td><td style = \"text-align: left;\">Foreign</td><td style = \"text-align: left;\">A3シリーズ</td><td style = \"text-align: right;\">3874</td><td style = \"text-align: left;\">アトラクション</td><td style = \"text-align: right;\">2.93944</td><td style = \"text-align: left;\">GH-8PBSE</td><td style = \"text-align: right;\">12.2</td><td style = \"text-align: right;\">5</td><td style = \"text-align: left;\">ハイオク</td><td style = \"text-align: right;\">51713048</td><td style = \"text-align: right;\">10.8151</td><td style = \"text-align: right;\">0.075</td><td style = \"text-align: right;\">7.49134e-5</td><td style = \"text-align: right;\">0.920174</td><td style = \"text-align: right;\">0.312689</td><td style = \"text-align: right;\">35.4</td><td style = \"text-align: right;\">33.111</td><td style = \"text-align: right;\">0.0357225</td><td style = \"text-align: right;\">418.28</td><td style = \"text-align: right;\">365.938</td><td style = \"text-align: right;\">2.08997</td><td style = \"text-align: right;\">225.1</td><td style = \"text-align: right;\">232.358</td><td style = \"text-align: right;\">0.230908</td><td style = \"text-align: right;\">2583.73</td><td style = \"text-align: right;\">2733.06</td><td style = \"text-align: right;\">0.237689</td><td style = \"text-align: right;\">23.2</td><td style = \"text-align: right;\">22.2959</td><td style = \"text-align: right;\">16.0534</td><td style = \"text-align: right;\">2382.0</td><td style = \"text-align: right;\">1839.16</td><td style = \"text-align: right;\">2</td><td style = \"text-align: right;\">162</td><td style = \"text-align: right;\">0.00569413</td><td style = \"text-align: right;\">1.04</td><td style = \"text-align: right;\">0.639514</td><td style = \"text-align: right;\">0.252811</td><td style = \"text-align: right;\">4335.92</td><td style = \"text-align: right;\">1039.11</td><td style = \"text-align: right;\">-9.41599</td><td style = \"text-align: right;\">0.237689</td><td style = \"text-align: right;\">23.2</td><td style = \"text-align: right;\">22.2959</td><td style = \"text-align: right;\">1.77728</td><td style = \"text-align: right;\">189.7</td><td style = \"text-align: right;\">199.247</td><td style = \"text-align: right;\">2</td><td style = \"text-align: right;\">17</td><td style = \"text-align: right;\">0.00569413</td><td style = \"text-align: right;\">1.04</td><td style = \"text-align: right;\">0.639514</td><td style = \"text-align: right;\">0.0242194</td><td style = \"text-align: right;\">67.05</td><td style = \"text-align: right;\">45.7941</td><td style = \"text-align: right;\">162015</td><td style = \"text-align: right;\">0.0239114</td><td style = \"text-align: right;\">-3.7334</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Data cleaning\n\n::: {.cell execution_count=3}\n``` {.julia .cell-code}\ndata[!, :Foreign_d] = data[:, :Type] .== \"Foreign\";\ndata[!, :FuelRegular_d] = data[:, :FuelType] .== \"レギュラー\";\ndata[!, :capacity_d] = data[:, :capacity] .> 4;\ntransform!(data, [:year => ByRow(isequal(v))=> Symbol(\"year_\" * string(v)) for v in unique(data.year)]);\nselect!(data, Not(:year_2006));\n```\n:::\n\n\n## 4.2\n\n::: {.cell execution_count=4}\n``` {.julia .cell-code}\nsort!(data, [:year, :Maker, :price]);\nN = nrow(data);\nT = length(unique(data.year));\nX1 = hcat(\n    repeat([1], N), \n    Matrix(data[:, [:price, :FuelEfficiency, :hppw, :size, :capacity_d, :FuelRegular_d, :Foreign_d]]),\n    Matrix(data[:, r\"^year_\"])    \n    );\nX2 = Matrix(data[:, [:price]]);\nZ = hcat(\n    repeat([1], N),\n    Matrix(data[:, [:FuelEfficiency, :hppw, :size, :capacity_d, :FuelRegular_d, :Foreign_d]]),\n    Matrix(data[:, r\"^year_\"]),\n    Matrix(data[:, r\"^iv_GH.*(?<!nest)$\"])\n    );\nRandom.seed!(42);\nNsim = 1000;\n\ndraw_vec = reduce(hcat, [randn(size(X2, 2)) for j =1:Nsim]);\n\nmarketindex = data.year;\nuniquemarketindex = sort(unique(data.year));\n```\n:::\n\n\n::: {.cell execution_count=5}\n``` {.julia .cell-code}\ntemp1 = reduce(hcat, [uniquemarketindex for j = 1:N])';\ntemp2 = reduce(hcat, [data.year for j = 1:T]);\nmkt_denom_d = (temp1 .== temp2);\n\nmutable struct datalist_struct\n    X1::Array{Float64,2};\n    X2::Array{Float64,2};\n    Z::Array{Float64,2};\n    ShareVec::Vector{Float64};\n    marketindex::Vector{Int64};\n    logitshare::Vector{Float64};\n    draw_vec::Array{Float64,2};\n    mkt_denom_d::BitMatrix\nend\n\nmutable struct parameter_struct\n    Nsim::Int;\n    T::Int;\n    N::Int;\nend\ndatalist = datalist_struct(X1, X2, Z, data.share, marketindex, data.logit_share, draw_vec, mkt_denom_d);\nparameter = parameter_struct(Nsim, T, N);\n```\n:::\n\n\n## 4.3\n\n::: {.cell execution_count=6}\n``` {.julia .cell-code}\nfunction f_mktshare(\n        theta2,\n        datalist::datalist_struct,\n        parameter::parameter_struct,\n#         delta::Vector{Float64}\n        delta\n    )\n        \n    mu = datalist.X2 * Diagonal(theta2) * datalist.draw_vec;\n    \n    delta_mu = delta .* ones((1, parameter.Nsim)) .+ mu;\n    exp_delta_mu = exp.(delta_mu .- maximum(delta_mu));\n    denom_outside = exp.(-maximum(delta_mu));\n    \n    denom_temp = (exp_delta_mu' * datalist.mkt_denom_d)' .+ denom_outside;\n    denom = datalist.mkt_denom_d * denom_temp;\n    \n    s_jt_i = exp_delta_mu ./ denom;\n    s_jt = vec(mean(s_jt_i, dims = 2));\n    \n    return s_jt\n    \nend\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```\nf_mktshare (generic function with 1 method)\n```\n:::\n:::\n\n\n\n\n::: {.cell execution_count=8}\n``` {.julia .cell-code}\nfunction f_contraction(\n        theta2,\n        datalist::datalist_struct,\n        parameter::parameter_struct,\n        delta_ini::Vector{Float64}\n    )\n    \n    tol = 1e-11;\n    norm = 1e+10\n\n    delta_old = delta_ini;\n    exp_delta_old = exp.(delta_old);\n    \n    iter = 0;\n        \n    while ((norm > tol) & (iter < 1000))\n        \n        # print(iter, \"\\n\")\n        \n        pred_mkt_share = f_mktshare(theta2, datalist, parameter, delta_old);\n        \n        exp_delta = exp_delta_old .* datalist.ShareVec ./ pred_mkt_share;\n        \n        norm = maximum(abs.(exp_delta .- exp_delta_old));\n        \n        exp_delta_old = exp_delta;\n        delta_old = log.(exp_delta_old);\n        iter += 1;\n        \n    end\n    \n#     print(iter, \"\\n\")\n    \n    return delta_old;\n    \nend\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\nf_contraction (generic function with 1 method)\n```\n:::\n:::\n\n\n\n\n::: {.cell execution_count=10}\n``` {.julia .cell-code}\nfunction f_GMMobj(\n        theta2,\n        parameter::parameter_struct,\n        datalist::datalist_struct,\n        delta_ini::Vector{Float64}\n    )\n    \n#     delta_ini = delta_global;\n#     delta_ini = datalist.logitshare;\n    delta = f_contraction(theta2, datalist, parameter, delta_ini);\n#     global delta_global = delta\n    \n#     if (datalist.weight_mat_option == \"2SLS\") \n        W = inv(datalist.Z' * datalist.Z);\n#     elseif (datalist.weight_mat_option == \"Ident\")\n#         W = I(size(datalist.Z, 2));\n#     end\n    \n    beta_hat = (datalist.X1' * datalist.Z * W * datalist.Z' * datalist.X1) \\ (datalist.X1' * datalist.Z * W * datalist.Z' * delta);\n    \n    Xi = delta - datalist.X1 * beta_hat;\n    \n    output = Xi' * datalist.Z * W * datalist.Z' * Xi\n        \n    return output\n    \nend    \n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```\nf_GMMobj (generic function with 1 method)\n```\n:::\n:::\n\n\n::: {.cell execution_count=11}\n``` {.julia .cell-code}\ninitial_x = [0.1];\ndelta_ini = f_contraction(initial_x, datalist, parameter, datalist.logitshare);\nobjFunc_for_Optim = TwiceDifferentiable(\n    x -> f_GMMobj(x, parameter, datalist, delta_ini),\n    initial_x;\n    autodiff = :forward\n    );\n```\n:::\n\n\n::: {.cell execution_count=12}\n``` {.julia .cell-code}\n@time gmm_res = optimize(\n    objFunc_for_Optim,\n#     x -> f_GMMobj(x, parameter, datalist, delta_ini),\n    [0.0],\n    [Inf],\n    initial_x,\n    Optim.Options(show_trace = true)\n)\n```\n:::\n\n\n\n\n\n\n::: {.cell execution_count=15}\n``` {.julia .cell-code}\nW = inv(datalist.Z' * datalist.Z);    \ndelta = f_contraction(gmm_res.minimizer, datalist, parameter, delta_ini);\nbeta_hat = (datalist.X1' * datalist.Z * W * datalist.Z' * datalist.X1) \\ (datalist.X1' * datalist.Z * W * datalist.Z' * delta);\n```\n:::\n\n\n::: {.cell execution_count=16}\n``` {.julia .cell-code}\nXi = delta - X1 * beta_hat;\nOmega_hat = reduce(+, Z[i,:] * Z[i,:]' .* Xi[i]^2 ./ N for i = 1:N);\nDdelta = ForwardDiff.jacobian(x -> delta_ini = f_contraction(x, datalist, parameter, delta), gmm_res.minimizer);\nG = Z' * hcat(- X1, Ddelta) ./ N;\nAsyVarMat = (G' * W * G) \\ G' * W * Omega_hat * W * G * inv(G' * W * G);\nAse = sqrt.(diag(AsyVarMat) ./ N);\nDataFrame(\n    Var = [\n        \"Const\", \"Price\", \"Fuel Efficiency\", \"hppw\", \"size\", \n        \"capacity_d\", \"FuelRegular_d\", \"Foreign_d\",\n        \"year_2007\", \"year_2008\", \"year_2009\", \n        \"year_2010\", \"year_2011\", \"year_2012\", \n        \"year_2013\", \"year_2014\", \"year_2015\", \"year_2016\", \n        \"random_price\"\n        ],\n    Est = vcat(beta_hat, gmm_res.minimizer),\n    se = Ase\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```{=html}\n<div><div style = \"float: left;\"><span>19×3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Var</th><th style = \"text-align: left;\">Est</th><th style = \"text-align: left;\">se</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Const</td><td style = \"text-align: right;\">-13.8731</td><td style = \"text-align: right;\">0.57026</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">Price</td><td style = \"text-align: right;\">-2.26772</td><td style = \"text-align: right;\">0.654208</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">Fuel Efficiency</td><td style = \"text-align: right;\">0.195358</td><td style = \"text-align: right;\">0.0125426</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">hppw</td><td style = \"text-align: right;\">14.123</td><td style = \"text-align: right;\">3.47038</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">size</td><td style = \"text-align: right;\">0.545374</td><td style = \"text-align: right;\">0.0755396</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">capacity_d</td><td style = \"text-align: right;\">-0.313033</td><td style = \"text-align: right;\">0.137174</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">FuelRegular_d</td><td style = \"text-align: right;\">-1.09267</td><td style = \"text-align: right;\">0.283308</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">Foreign_d</td><td style = \"text-align: right;\">1.02095</td><td style = \"text-align: right;\">0.188846</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">year_2007</td><td style = \"text-align: right;\">-0.832913</td><td style = \"text-align: right;\">0.173999</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: left;\">year_2008</td><td style = \"text-align: right;\">-0.701377</td><td style = \"text-align: right;\">0.167621</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">11</td><td style = \"text-align: left;\">year_2009</td><td style = \"text-align: right;\">-0.85305</td><td style = \"text-align: right;\">0.168625</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">12</td><td style = \"text-align: left;\">year_2010</td><td style = \"text-align: right;\">-0.0979013</td><td style = \"text-align: right;\">0.15156</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">13</td><td style = \"text-align: left;\">year_2011</td><td style = \"text-align: right;\">-0.251012</td><td style = \"text-align: right;\">0.150935</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">14</td><td style = \"text-align: left;\">year_2012</td><td style = \"text-align: right;\">-0.482276</td><td style = \"text-align: right;\">0.159593</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15</td><td style = \"text-align: left;\">year_2013</td><td style = \"text-align: right;\">-0.623362</td><td style = \"text-align: right;\">0.165287</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">16</td><td style = \"text-align: left;\">year_2014</td><td style = \"text-align: right;\">-1.04477</td><td style = \"text-align: right;\">0.180093</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">17</td><td style = \"text-align: left;\">year_2015</td><td style = \"text-align: right;\">-1.1434</td><td style = \"text-align: right;\">0.178264</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">18</td><td style = \"text-align: left;\">year_2016</td><td style = \"text-align: right;\">-1.24577</td><td style = \"text-align: right;\">0.181075</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">19</td><td style = \"text-align: left;\">random_price</td><td style = \"text-align: right;\">0.647326</td><td style = \"text-align: right;\">0.218627</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=17}\n``` {.julia .cell-code}\nmu = X2 * Diagonal(gmm_res.minimizer) * draw_vec;\ndelta_mu = delta .+ mu;\nexp_delta_mu = exp.(delta_mu);\ndenom_outside = exp.(0.0);\ndenom_temp = (exp_delta_mu' * mkt_denom_d)' .+ denom_outside;\ndenom = mkt_denom_d * denom_temp;\n\ns_jt_i = exp_delta_mu ./ denom;\ndraw_for_price = draw_vec[1,:];\nalpha_i = beta_hat[2] .+ gmm_res.minimizer[1] .* draw_for_price;\nyear = 2016\nJ_t = sum(data.year .== year);\ndata_t = data[data.year .== year, :];\n\nag_model_s_i = s_jt_i[data.year .== year, :]\nag_model_s = mean(ag_model_s_i, dims = 2);\nprice_t = data.price[data.year .== year];\n\nelasmat_t = zeros((J_t, J_t));\n\nfor k in 1:J_t, j in 1:J_t\n    if (k != j)\n        elasmat_t[k, j] = (-1.0) .* price_t[k] ./ ag_model_s[j] * mean(alpha_i .* ag_model_s_i[j, :] .* ag_model_s_i[k, :])\n    elseif (k == j)\n        elasmat_t[k, j] = price_t[j] ./ ag_model_s[j] * mean(alpha_i .* ag_model_s_i[j, :] .* (1.0 .- ag_model_s_i[j, :]))\n    end\nend\n```\n:::\n\n\n## 5\n\n::: {.cell execution_count=18}\n``` {.julia .cell-code}\nPricevec_t = data_t.price;\nSharevec_t = data_t.share;\n\nOwnership_t = data_t.Maker .== permutedims(data_t.Maker);\nDerivative_t = - elasmat_t .* Sharevec_t' ./ Pricevec_t;\nDelta_t = Derivative_t .* Ownership_t;\nMarginal_Cost_t = Pricevec_t - (Delta_t \\ Sharevec_t);\npred_mc_df = DataFrame(\n    Maker = data_t.Maker, \n    Name = data_t.Name, \n    Price = data_t.price,\n    MC = Vector{Float64}(Marginal_Cost_t),\n    Margin = (data_t.price .- Marginal_Cost_t) ./ data_t.price\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```{=html}\n<div><div style = \"float: left;\"><span>169×5 DataFrame</span></div><div style = \"float: right;\"><span style = \"font-style: italic;\">144 rows omitted</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Maker</th><th style = \"text-align: left;\">Name</th><th style = \"text-align: left;\">Price</th><th style = \"text-align: left;\">MC</th><th style = \"text-align: left;\">Margin</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String15\" style = \"text-align: left;\">String15</th><th title = \"String31\" style = \"text-align: left;\">String31</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Audi</td><td style = \"text-align: left;\">A3シリーズ</td><td style = \"text-align: right;\">3.28</td><td style = \"text-align: right;\">2.37501</td><td style = \"text-align: right;\">0.275912</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">Audi</td><td style = \"text-align: left;\">A4シリーズ</td><td style = \"text-align: right;\">5.18</td><td style = \"text-align: right;\">3.63239</td><td style = \"text-align: right;\">0.298766</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">BMW</td><td style = \"text-align: left;\">ミニ</td><td style = \"text-align: right;\">2.4</td><td style = \"text-align: right;\">1.68184</td><td style = \"text-align: right;\">0.299235</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">BMW</td><td style = \"text-align: left;\">1シリーズ</td><td style = \"text-align: right;\">3.1</td><td style = \"text-align: right;\">2.23582</td><td style = \"text-align: right;\">0.278768</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">BMW</td><td style = \"text-align: left;\">X1</td><td style = \"text-align: right;\">3.67</td><td style = \"text-align: right;\">2.65528</td><td style = \"text-align: right;\">0.276489</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">BMW</td><td style = \"text-align: left;\">2シリーズ</td><td style = \"text-align: right;\">3.81</td><td style = \"text-align: right;\">2.75368</td><td style = \"text-align: right;\">0.27725</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">BMW</td><td style = \"text-align: left;\">3シリーズ</td><td style = \"text-align: right;\">4.49</td><td style = \"text-align: right;\">3.2058</td><td style = \"text-align: right;\">0.286013</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">Daihatsu</td><td style = \"text-align: left;\">ミラ</td><td style = \"text-align: right;\">0.885</td><td style = \"text-align: right;\">0.367591</td><td style = \"text-align: right;\">0.584643</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">Daihatsu</td><td style = \"text-align: left;\">ムーヴ</td><td style = \"text-align: right;\">1.134</td><td style = \"text-align: right;\">0.590801</td><td style = \"text-align: right;\">0.479012</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: left;\">Daihatsu</td><td style = \"text-align: left;\">ブーン</td><td style = \"text-align: right;\">1.15</td><td style = \"text-align: right;\">0.605056</td><td style = \"text-align: right;\">0.473864</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">11</td><td style = \"text-align: left;\">Daihatsu</td><td style = \"text-align: left;\">キャスト</td><td style = \"text-align: right;\">1.22</td><td style = \"text-align: right;\">0.667293</td><td style = \"text-align: right;\">0.453039</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">12</td><td style = \"text-align: left;\">Daihatsu</td><td style = \"text-align: left;\">タント</td><td style = \"text-align: right;\">1.22</td><td style = \"text-align: right;\">0.667293</td><td style = \"text-align: right;\">0.453039</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">13</td><td style = \"text-align: left;\">Daihatsu</td><td style = \"text-align: left;\">ウェイク</td><td style = \"text-align: right;\">1.35</td><td style = \"text-align: right;\">0.782294</td><td style = \"text-align: right;\">0.420523</td></tr><tr><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">158</td><td style = \"text-align: left;\">Toyota</td><td style = \"text-align: left;\">FJクルーザー</td><td style = \"text-align: right;\">3.24</td><td style = \"text-align: right;\">2.28354</td><td style = \"text-align: right;\">0.295204</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">159</td><td style = \"text-align: left;\">Toyota</td><td style = \"text-align: left;\">エスティマ</td><td style = \"text-align: right;\">3.271</td><td style = \"text-align: right;\">2.30594</td><td style = \"text-align: right;\">0.295034</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">160</td><td style = \"text-align: left;\">Toyota</td><td style = \"text-align: left;\">SAI</td><td style = \"text-align: right;\">3.304</td><td style = \"text-align: right;\">2.32969</td><td style = \"text-align: right;\">0.294888</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">161</td><td style = \"text-align: left;\">Toyota</td><td style = \"text-align: left;\">クラウン</td><td style = \"text-align: right;\">3.812</td><td style = \"text-align: right;\">2.68183</td><td style = \"text-align: right;\">0.296477</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">162</td><td style = \"text-align: left;\">Toyota</td><td style = \"text-align: left;\">ランドクルーザー</td><td style = \"text-align: right;\">4.728</td><td style = \"text-align: right;\">3.25502</td><td style = \"text-align: right;\">0.311544</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">163</td><td style = \"text-align: left;\">Toyota</td><td style = \"text-align: left;\">センチュリー</td><td style = \"text-align: right;\">12.538</td><td style = \"text-align: right;\">7.4994</td><td style = \"text-align: right;\">0.401866</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">164</td><td style = \"text-align: left;\">Volkswagen</td><td style = \"text-align: left;\">ポロ</td><td style = \"text-align: right;\">1.999</td><td style = \"text-align: right;\">1.3488</td><td style = \"text-align: right;\">0.325264</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">165</td><td style = \"text-align: left;\">Volkswagen</td><td style = \"text-align: left;\">ゴルフ</td><td style = \"text-align: right;\">2.499</td><td style = \"text-align: right;\">1.76419</td><td style = \"text-align: right;\">0.294041</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">166</td><td style = \"text-align: left;\">Volkswagen</td><td style = \"text-align: left;\">ビートル</td><td style = \"text-align: right;\">2.699</td><td style = \"text-align: right;\">1.92528</td><td style = \"text-align: right;\">0.28667</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">167</td><td style = \"text-align: left;\">Volkswagen</td><td style = \"text-align: left;\">パサート</td><td style = \"text-align: right;\">3.486</td><td style = \"text-align: right;\">2.52664</td><td style = \"text-align: right;\">0.275203</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">168</td><td style = \"text-align: left;\">Volvo</td><td style = \"text-align: left;\">40シリーズ</td><td style = \"text-align: right;\">3.24</td><td style = \"text-align: right;\">2.3454</td><td style = \"text-align: right;\">0.27611</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">169</td><td style = \"text-align: left;\">Volvo</td><td style = \"text-align: left;\">60シリーズ</td><td style = \"text-align: right;\">4.54</td><td style = \"text-align: right;\">3.24472</td><td style = \"text-align: right;\">0.285305</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=19}\n``` {.julia .cell-code}\nhistogram(pred_mc_df.Margin, bins = 40, legend = false)\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```{=html}\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"672\" height=\"480\" viewBox=\"0 0 2688 1920\">\n<defs>\n  <clipPath id=\"clip310\">\n    <rect x=\"0\" y=\"0\" width=\"2688\" height=\"1920\"/>\n  </clipPath>\n</defs>\n<path clip-path=\"url(#clip310)\" d=\"M0 1920 L2688 1920 L2688 0 L0 0  Z\" fill=\"#ffffff\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<defs>\n  <clipPath id=\"clip311\">\n    <rect x=\"537\" y=\"0\" width=\"1883\" height=\"1883\"/>\n  </clipPath>\n</defs>\n<path clip-path=\"url(#clip310)\" d=\"M143.576 1800.78 L2640.76 1800.78 L2640.76 47.2441 L143.576 47.2441  Z\" fill=\"#ffffff\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<defs>\n  <clipPath id=\"clip312\">\n    <rect x=\"143\" y=\"47\" width=\"2498\" height=\"1755\"/>\n  </clipPath>\n</defs>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"443.546,1800.78 443.546,47.2441 \"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"985.614,1800.78 985.614,47.2441 \"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"1527.68,1800.78 1527.68,47.2441 \"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"2069.75,1800.78 2069.75,47.2441 \"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"2611.82,1800.78 2611.82,47.2441 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"143.576,1800.78 2640.76,1800.78 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"443.546,1800.78 443.546,1781.88 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"985.614,1800.78 985.614,1781.88 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1527.68,1800.78 1527.68,1781.88 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2069.75,1800.78 2069.75,1781.88 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2611.82,1800.78 2611.82,1781.88 \"/>\n<path clip-path=\"url(#clip310)\" d=\"M421.254 1834 Q417.643 1834 415.814 1837.57 Q414.009 1841.11 414.009 1848.24 Q414.009 1855.34 415.814 1858.91 Q417.643 1862.45 421.254 1862.45 Q424.888 1862.45 426.694 1858.91 Q428.522 1855.34 428.522 1848.24 Q428.522 1841.11 426.694 1837.57 Q424.888 1834 421.254 1834 M421.254 1830.3 Q427.064 1830.3 430.12 1834.9 Q433.198 1839.49 433.198 1848.24 Q433.198 1856.96 430.12 1861.57 Q427.064 1866.15 421.254 1866.15 Q415.444 1866.15 412.365 1861.57 Q409.31 1856.96 409.31 1848.24 Q409.31 1839.49 412.365 1834.9 Q415.444 1830.3 421.254 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M441.416 1859.6 L446.3 1859.6 L446.3 1865.48 L441.416 1865.48 L441.416 1859.6 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M470.652 1846.85 Q474.008 1847.57 475.883 1849.84 Q477.781 1852.1 477.781 1855.44 Q477.781 1860.55 474.263 1863.35 Q470.744 1866.15 464.263 1866.15 Q462.087 1866.15 459.772 1865.71 Q457.481 1865.3 455.027 1864.44 L455.027 1859.93 Q456.971 1861.06 459.286 1861.64 Q461.601 1862.22 464.124 1862.22 Q468.522 1862.22 470.814 1860.48 Q473.129 1858.75 473.129 1855.44 Q473.129 1852.38 470.976 1850.67 Q468.846 1848.93 465.027 1848.93 L460.999 1848.93 L460.999 1845.09 L465.212 1845.09 Q468.661 1845.09 470.49 1843.72 Q472.319 1842.34 472.319 1839.74 Q472.319 1837.08 470.42 1835.67 Q468.545 1834.23 465.027 1834.23 Q463.106 1834.23 460.907 1834.65 Q458.707 1835.07 456.069 1835.95 L456.069 1831.78 Q458.731 1831.04 461.045 1830.67 Q463.383 1830.3 465.444 1830.3 Q470.768 1830.3 473.869 1832.73 Q476.971 1835.14 476.971 1839.26 Q476.971 1842.13 475.328 1844.12 Q473.684 1846.09 470.652 1846.85 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M962.756 1834 Q959.144 1834 957.316 1837.57 Q955.51 1841.11 955.51 1848.24 Q955.51 1855.34 957.316 1858.91 Q959.144 1862.45 962.756 1862.45 Q966.39 1862.45 968.195 1858.91 Q970.024 1855.34 970.024 1848.24 Q970.024 1841.11 968.195 1837.57 Q966.39 1834 962.756 1834 M962.756 1830.3 Q968.566 1830.3 971.621 1834.9 Q974.7 1839.49 974.7 1848.24 Q974.7 1856.96 971.621 1861.57 Q968.566 1866.15 962.756 1866.15 Q956.945 1866.15 953.867 1861.57 Q950.811 1856.96 950.811 1848.24 Q950.811 1839.49 953.867 1834.9 Q956.945 1830.3 962.756 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M982.917 1859.6 L987.802 1859.6 L987.802 1865.48 L982.917 1865.48 L982.917 1859.6 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M1010.83 1835 L999.028 1853.45 L1010.83 1853.45 L1010.83 1835 M1009.61 1830.92 L1015.49 1830.92 L1015.49 1853.45 L1020.42 1853.45 L1020.42 1857.34 L1015.49 1857.34 L1015.49 1865.48 L1010.83 1865.48 L1010.83 1857.34 L995.232 1857.34 L995.232 1852.82 L1009.61 1830.92 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M1505.56 1834 Q1501.95 1834 1500.13 1837.57 Q1498.32 1841.11 1498.32 1848.24 Q1498.32 1855.34 1500.13 1858.91 Q1501.95 1862.45 1505.56 1862.45 Q1509.2 1862.45 1511 1858.91 Q1512.83 1855.34 1512.83 1848.24 Q1512.83 1841.11 1511 1837.57 Q1509.2 1834 1505.56 1834 M1505.56 1830.3 Q1511.38 1830.3 1514.43 1834.9 Q1517.51 1839.49 1517.51 1848.24 Q1517.51 1856.96 1514.43 1861.57 Q1511.38 1866.15 1505.56 1866.15 Q1499.75 1866.15 1496.68 1861.57 Q1493.62 1856.96 1493.62 1848.24 Q1493.62 1839.49 1496.68 1834.9 Q1499.75 1830.3 1505.56 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M1525.73 1859.6 L1530.61 1859.6 L1530.61 1865.48 L1525.73 1865.48 L1525.73 1859.6 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M1540.84 1830.92 L1559.2 1830.92 L1559.2 1834.86 L1545.12 1834.86 L1545.12 1843.33 Q1546.14 1842.98 1547.16 1842.82 Q1548.18 1842.64 1549.2 1842.64 Q1554.99 1842.64 1558.37 1845.81 Q1561.75 1848.98 1561.75 1854.4 Q1561.75 1859.97 1558.27 1863.08 Q1554.8 1866.15 1548.48 1866.15 Q1546.31 1866.15 1544.04 1865.78 Q1541.79 1865.41 1539.38 1864.67 L1539.38 1859.97 Q1541.47 1861.11 1543.69 1861.66 Q1545.91 1862.22 1548.39 1862.22 Q1552.39 1862.22 1554.73 1860.11 Q1557.07 1858.01 1557.07 1854.4 Q1557.07 1850.78 1554.73 1848.68 Q1552.39 1846.57 1548.39 1846.57 Q1546.51 1846.57 1544.64 1846.99 Q1542.79 1847.4 1540.84 1848.28 L1540.84 1830.92 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M2047.05 1834 Q2043.44 1834 2041.62 1837.57 Q2039.81 1841.11 2039.81 1848.24 Q2039.81 1855.34 2041.62 1858.91 Q2043.44 1862.45 2047.05 1862.45 Q2050.69 1862.45 2052.49 1858.91 Q2054.32 1855.34 2054.32 1848.24 Q2054.32 1841.11 2052.49 1837.57 Q2050.69 1834 2047.05 1834 M2047.05 1830.3 Q2052.87 1830.3 2055.92 1834.9 Q2059 1839.49 2059 1848.24 Q2059 1856.96 2055.92 1861.57 Q2052.87 1866.15 2047.05 1866.15 Q2041.24 1866.15 2038.17 1861.57 Q2035.11 1856.96 2035.11 1848.24 Q2035.11 1839.49 2038.17 1834.9 Q2041.24 1830.3 2047.05 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M2067.22 1859.6 L2072.1 1859.6 L2072.1 1865.48 L2067.22 1865.48 L2067.22 1859.6 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M2092.86 1846.34 Q2089.72 1846.34 2087.86 1848.49 Q2086.04 1850.65 2086.04 1854.4 Q2086.04 1858.12 2087.86 1860.3 Q2089.72 1862.45 2092.86 1862.45 Q2096.01 1862.45 2097.84 1860.3 Q2099.69 1858.12 2099.69 1854.4 Q2099.69 1850.65 2097.84 1848.49 Q2096.01 1846.34 2092.86 1846.34 M2102.15 1831.69 L2102.15 1835.95 Q2100.39 1835.11 2098.58 1834.67 Q2096.8 1834.23 2095.04 1834.23 Q2090.41 1834.23 2087.96 1837.36 Q2085.53 1840.48 2085.18 1846.8 Q2086.55 1844.79 2088.61 1843.72 Q2090.67 1842.64 2093.14 1842.64 Q2098.35 1842.64 2101.36 1845.81 Q2104.39 1848.96 2104.39 1854.4 Q2104.39 1859.72 2101.24 1862.94 Q2098.1 1866.15 2092.86 1866.15 Q2086.87 1866.15 2083.7 1861.57 Q2080.53 1856.96 2080.53 1848.24 Q2080.53 1840.04 2084.42 1835.18 Q2088.3 1830.3 2094.86 1830.3 Q2096.61 1830.3 2098.4 1830.65 Q2100.2 1830.99 2102.15 1831.69 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M2589.66 1834 Q2586.04 1834 2584.22 1837.57 Q2582.41 1841.11 2582.41 1848.24 Q2582.41 1855.34 2584.22 1858.91 Q2586.04 1862.45 2589.66 1862.45 Q2593.29 1862.45 2595.1 1858.91 Q2596.92 1855.34 2596.92 1848.24 Q2596.92 1841.11 2595.1 1837.57 Q2593.29 1834 2589.66 1834 M2589.66 1830.3 Q2595.47 1830.3 2598.52 1834.9 Q2601.6 1839.49 2601.6 1848.24 Q2601.6 1856.96 2598.52 1861.57 Q2595.47 1866.15 2589.66 1866.15 Q2583.85 1866.15 2580.77 1861.57 Q2577.71 1856.96 2577.71 1848.24 Q2577.71 1839.49 2580.77 1834.9 Q2583.85 1830.3 2589.66 1830.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M2609.82 1859.6 L2614.7 1859.6 L2614.7 1865.48 L2609.82 1865.48 L2609.82 1859.6 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M2623.71 1830.92 L2645.93 1830.92 L2645.93 1832.91 L2633.38 1865.48 L2628.5 1865.48 L2640.3 1834.86 L2623.71 1834.86 L2623.71 1830.92 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"143.576,1800.78 2640.76,1800.78 \"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"143.576,1419.58 2640.76,1419.58 \"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"143.576,1038.37 2640.76,1038.37 \"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"143.576,657.169 2640.76,657.169 \"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none\" points=\"143.576,275.966 2640.76,275.966 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"143.576,1800.78 143.576,47.2441 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"143.576,1800.78 162.473,1800.78 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"143.576,1419.58 162.473,1419.58 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"143.576,1038.37 162.473,1038.37 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"143.576,657.169 162.473,657.169 \"/>\n<polyline clip-path=\"url(#clip310)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"143.576,275.966 162.473,275.966 \"/>\n<path clip-path=\"url(#clip310)\" d=\"M91.3112 1786.58 Q87.7001 1786.58 85.8714 1790.14 Q84.0658 1793.68 84.0658 1800.81 Q84.0658 1807.92 85.8714 1811.49 Q87.7001 1815.03 91.3112 1815.03 Q94.9454 1815.03 96.7509 1811.49 Q98.5796 1807.92 98.5796 1800.81 Q98.5796 1793.68 96.7509 1790.14 Q94.9454 1786.58 91.3112 1786.58 M91.3112 1782.87 Q97.1213 1782.87 100.177 1787.48 Q103.256 1792.06 103.256 1800.81 Q103.256 1809.54 100.177 1814.15 Q97.1213 1818.73 91.3112 1818.73 Q85.501 1818.73 82.4223 1814.15 Q79.3668 1809.54 79.3668 1800.81 Q79.3668 1792.06 82.4223 1787.48 Q85.501 1782.87 91.3112 1782.87 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M82.3529 1402.3 L100.709 1402.3 L100.709 1406.23 L86.6353 1406.23 L86.6353 1414.7 Q87.6538 1414.36 88.6723 1414.19 Q89.6908 1414.01 90.7093 1414.01 Q96.4963 1414.01 99.8759 1417.18 Q103.256 1420.35 103.256 1425.77 Q103.256 1431.35 99.7833 1434.45 Q96.3111 1437.53 89.9917 1437.53 Q87.8158 1437.53 85.5473 1437.16 Q83.3019 1436.79 80.8946 1436.05 L80.8946 1431.35 Q82.9779 1432.48 85.2001 1433.04 Q87.4223 1433.59 89.8991 1433.59 Q93.9037 1433.59 96.2417 1431.49 Q98.5796 1429.38 98.5796 1425.77 Q98.5796 1422.16 96.2417 1420.05 Q93.9037 1417.94 89.8991 1417.94 Q88.0241 1417.94 86.1492 1418.36 Q84.2973 1418.78 82.3529 1419.66 L82.3529 1402.3 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M51.9595 1051.72 L59.5984 1051.72 L59.5984 1025.35 L51.2882 1027.02 L51.2882 1022.76 L59.5521 1021.09 L64.228 1021.09 L64.228 1051.72 L71.8668 1051.72 L71.8668 1055.65 L51.9595 1055.65 L51.9595 1051.72 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M91.3112 1024.17 Q87.7001 1024.17 85.8714 1027.74 Q84.0658 1031.28 84.0658 1038.41 Q84.0658 1045.51 85.8714 1049.08 Q87.7001 1052.62 91.3112 1052.62 Q94.9454 1052.62 96.7509 1049.08 Q98.5796 1045.51 98.5796 1038.41 Q98.5796 1031.28 96.7509 1027.74 Q94.9454 1024.17 91.3112 1024.17 M91.3112 1020.47 Q97.1213 1020.47 100.177 1025.07 Q103.256 1029.66 103.256 1038.41 Q103.256 1047.13 100.177 1051.74 Q97.1213 1056.32 91.3112 1056.32 Q85.501 1056.32 82.4223 1051.74 Q79.3668 1047.13 79.3668 1038.41 Q79.3668 1029.66 82.4223 1025.07 Q85.501 1020.47 91.3112 1020.47 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M52.9549 670.514 L60.5937 670.514 L60.5937 644.149 L52.2836 645.815 L52.2836 641.556 L60.5474 639.889 L65.2233 639.889 L65.2233 670.514 L72.8622 670.514 L72.8622 674.449 L52.9549 674.449 L52.9549 670.514 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M82.3529 639.889 L100.709 639.889 L100.709 643.825 L86.6353 643.825 L86.6353 652.297 Q87.6538 651.95 88.6723 651.787 Q89.6908 651.602 90.7093 651.602 Q96.4963 651.602 99.8759 654.774 Q103.256 657.945 103.256 663.361 Q103.256 668.94 99.7833 672.042 Q96.3111 675.121 89.9917 675.121 Q87.8158 675.121 85.5473 674.75 Q83.3019 674.38 80.8946 673.639 L80.8946 668.94 Q82.9779 670.074 85.2001 670.63 Q87.4223 671.186 89.8991 671.186 Q93.9037 671.186 96.2417 669.079 Q98.5796 666.973 98.5796 663.361 Q98.5796 659.75 96.2417 657.644 Q93.9037 655.537 89.8991 655.537 Q88.0241 655.537 86.1492 655.954 Q84.2973 656.371 82.3529 657.25 L82.3529 639.889 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M55.1771 289.311 L71.4965 289.311 L71.4965 293.246 L49.5521 293.246 L49.5521 289.311 Q52.2141 286.556 56.7975 281.927 Q61.4039 277.274 62.5845 275.931 Q64.8298 273.408 65.7094 271.672 Q66.6122 269.913 66.6122 268.223 Q66.6122 265.468 64.6678 263.732 Q62.7465 261.996 59.6447 261.996 Q57.4456 261.996 54.9919 262.76 Q52.5614 263.524 49.7836 265.075 L49.7836 260.353 Q52.6077 259.218 55.0614 258.64 Q57.515 258.061 59.5521 258.061 Q64.9224 258.061 68.1168 260.746 Q71.3113 263.431 71.3113 267.922 Q71.3113 270.052 70.5011 271.973 Q69.7141 273.871 67.6076 276.464 Q67.0289 277.135 63.927 280.353 Q60.8252 283.547 55.1771 289.311 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip310)\" d=\"M91.3112 261.765 Q87.7001 261.765 85.8714 265.33 Q84.0658 268.871 84.0658 276.001 Q84.0658 283.107 85.8714 286.672 Q87.7001 290.214 91.3112 290.214 Q94.9454 290.214 96.7509 286.672 Q98.5796 283.107 98.5796 276.001 Q98.5796 268.871 96.7509 265.33 Q94.9454 261.765 91.3112 261.765 M91.3112 258.061 Q97.1213 258.061 100.177 262.668 Q103.256 267.251 103.256 276.001 Q103.256 284.728 100.177 289.334 Q97.1213 293.917 91.3112 293.917 Q85.501 293.917 82.4223 289.334 Q79.3668 284.728 79.3668 276.001 Q79.3668 267.251 82.4223 262.668 Q85.501 258.061 91.3112 258.061 Z\" fill=\"#000000\" fill-rule=\"nonzero\" fill-opacity=\"1\" /><path clip-path=\"url(#clip312)\" d=\"M280.925 1114.61 L280.925 1800.78 L335.132 1800.78 L335.132 1114.61 L280.925 1114.61 L280.925 1114.61  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"280.925,1114.61 280.925,1800.78 335.132,1800.78 335.132,1114.61 280.925,1114.61 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M335.132 275.966 L335.132 1800.78 L389.339 1800.78 L389.339 275.966 L335.132 275.966 L335.132 275.966  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"335.132,275.966 335.132,1800.78 389.339,1800.78 389.339,275.966 335.132,275.966 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M389.339 47.2441 L389.339 1800.78 L443.546 1800.78 L443.546 47.2441 L389.339 47.2441 L389.339 47.2441  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"389.339,47.2441 389.339,1800.78 443.546,1800.78 443.546,47.2441 389.339,47.2441 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M443.546 885.891 L443.546 1800.78 L497.752 1800.78 L497.752 885.891 L443.546 885.891 L443.546 885.891  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"443.546,885.891 443.546,1800.78 497.752,1800.78 497.752,885.891 443.546,885.891 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M497.752 1190.85 L497.752 1800.78 L551.959 1800.78 L551.959 1190.85 L497.752 1190.85 L497.752 1190.85  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"497.752,1190.85 497.752,1800.78 551.959,1800.78 551.959,1190.85 497.752,1190.85 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M551.959 1114.61 L551.959 1800.78 L606.166 1800.78 L606.166 1114.61 L551.959 1114.61 L551.959 1114.61  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"551.959,1114.61 551.959,1800.78 606.166,1800.78 606.166,1114.61 551.959,1114.61 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M606.166 1495.82 L606.166 1800.78 L660.373 1800.78 L660.373 1495.82 L606.166 1495.82 L606.166 1495.82  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"606.166,1495.82 606.166,1800.78 660.373,1800.78 660.373,1495.82 606.166,1495.82 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M660.373 1114.61 L660.373 1800.78 L714.58 1800.78 L714.58 1114.61 L660.373 1114.61 L660.373 1114.61  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"660.373,1114.61 660.373,1800.78 714.58,1800.78 714.58,1114.61 660.373,1114.61 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M714.58 1114.61 L714.58 1800.78 L768.787 1800.78 L768.787 1114.61 L714.58 1114.61 L714.58 1114.61  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"714.58,1114.61 714.58,1800.78 768.787,1800.78 768.787,1114.61 714.58,1114.61 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M768.787 1267.09 L768.787 1800.78 L822.994 1800.78 L822.994 1267.09 L768.787 1267.09 L768.787 1267.09  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"768.787,1267.09 768.787,1800.78 822.994,1800.78 822.994,1267.09 768.787,1267.09 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M822.994 1572.06 L822.994 1800.78 L877.2 1800.78 L877.2 1572.06 L822.994 1572.06 L822.994 1572.06  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"822.994,1572.06 822.994,1800.78 877.2,1800.78 877.2,1572.06 822.994,1572.06 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M877.2 1495.82 L877.2 1800.78 L931.407 1800.78 L931.407 1495.82 L877.2 1495.82 L877.2 1495.82  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"877.2,1495.82 877.2,1800.78 931.407,1800.78 931.407,1495.82 877.2,1495.82 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M931.407 1419.58 L931.407 1800.78 L985.614 1800.78 L985.614 1419.58 L931.407 1419.58 L931.407 1419.58  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"931.407,1419.58 931.407,1800.78 985.614,1800.78 985.614,1419.58 931.407,1419.58 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M985.614 1038.37 L985.614 1800.78 L1039.82 1800.78 L1039.82 1038.37 L985.614 1038.37 L985.614 1038.37  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"985.614,1038.37 985.614,1800.78 1039.82,1800.78 1039.82,1038.37 985.614,1038.37 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1039.82 1190.85 L1039.82 1800.78 L1094.03 1800.78 L1094.03 1190.85 L1039.82 1190.85 L1039.82 1190.85  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1039.82,1190.85 1039.82,1800.78 1094.03,1800.78 1094.03,1190.85 1039.82,1190.85 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1094.03 1572.06 L1094.03 1800.78 L1148.23 1800.78 L1148.23 1572.06 L1094.03 1572.06 L1094.03 1572.06  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1094.03,1572.06 1094.03,1800.78 1148.23,1800.78 1148.23,1572.06 1094.03,1572.06 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1148.23 1572.06 L1148.23 1800.78 L1202.44 1800.78 L1202.44 1572.06 L1148.23 1572.06 L1148.23 1572.06  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1148.23,1572.06 1148.23,1800.78 1202.44,1800.78 1202.44,1572.06 1148.23,1572.06 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1202.44 1724.54 L1202.44 1800.78 L1256.65 1800.78 L1256.65 1724.54 L1202.44 1724.54 L1202.44 1724.54  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1202.44,1724.54 1202.44,1800.78 1256.65,1800.78 1256.65,1724.54 1202.44,1724.54 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1256.65 1572.06 L1256.65 1800.78 L1310.86 1800.78 L1310.86 1572.06 L1256.65 1572.06 L1256.65 1572.06  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1256.65,1572.06 1256.65,1800.78 1310.86,1800.78 1310.86,1572.06 1256.65,1572.06 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1310.86 1572.06 L1310.86 1800.78 L1365.06 1800.78 L1365.06 1572.06 L1310.86 1572.06 L1310.86 1572.06  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1310.86,1572.06 1310.86,1800.78 1365.06,1800.78 1365.06,1572.06 1310.86,1572.06 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1365.06 1419.58 L1365.06 1800.78 L1419.27 1800.78 L1419.27 1419.58 L1365.06 1419.58 L1365.06 1419.58  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1365.06,1419.58 1365.06,1800.78 1419.27,1800.78 1419.27,1419.58 1365.06,1419.58 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1419.27 1648.3 L1419.27 1800.78 L1473.48 1800.78 L1473.48 1648.3 L1419.27 1648.3 L1419.27 1648.3  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1419.27,1648.3 1419.27,1800.78 1473.48,1800.78 1473.48,1648.3 1419.27,1648.3 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1473.48 1572.06 L1473.48 1800.78 L1527.68 1800.78 L1527.68 1572.06 L1473.48 1572.06 L1473.48 1572.06  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1473.48,1572.06 1473.48,1800.78 1527.68,1800.78 1527.68,1572.06 1473.48,1572.06 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1527.68 1724.54 L1527.68 1800.78 L1581.89 1800.78 L1581.89 1724.54 L1527.68 1724.54 L1527.68 1724.54  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1527.68,1724.54 1527.68,1800.78 1581.89,1800.78 1581.89,1724.54 1527.68,1724.54 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1581.89 1800.78 L1581.89 1800.78 L1636.1 1800.78 L1636.1 1800.78 L1581.89 1800.78 L1581.89 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1581.89,1800.78 1581.89,1800.78 1636.1,1800.78 1581.89,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1636.1 1800.78 L1636.1 1800.78 L1690.3 1800.78 L1690.3 1800.78 L1636.1 1800.78 L1636.1 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1636.1,1800.78 1636.1,1800.78 1690.3,1800.78 1636.1,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1690.3 1800.78 L1690.3 1800.78 L1744.51 1800.78 L1744.51 1800.78 L1690.3 1800.78 L1690.3 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1690.3,1800.78 1690.3,1800.78 1744.51,1800.78 1690.3,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1744.51 1800.78 L1744.51 1800.78 L1798.72 1800.78 L1798.72 1800.78 L1744.51 1800.78 L1744.51 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1744.51,1800.78 1744.51,1800.78 1798.72,1800.78 1744.51,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1798.72 1800.78 L1798.72 1800.78 L1852.92 1800.78 L1852.92 1800.78 L1798.72 1800.78 L1798.72 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1798.72,1800.78 1798.72,1800.78 1852.92,1800.78 1798.72,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1852.92 1724.54 L1852.92 1800.78 L1907.13 1800.78 L1907.13 1724.54 L1852.92 1724.54 L1852.92 1724.54  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1852.92,1724.54 1852.92,1800.78 1907.13,1800.78 1907.13,1724.54 1852.92,1724.54 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1907.13 1800.78 L1907.13 1800.78 L1961.34 1800.78 L1961.34 1800.78 L1907.13 1800.78 L1907.13 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1907.13,1800.78 1907.13,1800.78 1961.34,1800.78 1907.13,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M1961.34 1724.54 L1961.34 1800.78 L2015.54 1800.78 L2015.54 1724.54 L1961.34 1724.54 L1961.34 1724.54  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"1961.34,1724.54 1961.34,1800.78 2015.54,1800.78 2015.54,1724.54 1961.34,1724.54 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M2015.54 1800.78 L2015.54 1800.78 L2069.75 1800.78 L2069.75 1800.78 L2015.54 1800.78 L2015.54 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2015.54,1800.78 2015.54,1800.78 2069.75,1800.78 2015.54,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M2069.75 1800.78 L2069.75 1800.78 L2123.96 1800.78 L2123.96 1800.78 L2069.75 1800.78 L2069.75 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2069.75,1800.78 2069.75,1800.78 2123.96,1800.78 2069.75,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M2123.96 1800.78 L2123.96 1800.78 L2178.17 1800.78 L2178.17 1800.78 L2123.96 1800.78 L2123.96 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2123.96,1800.78 2123.96,1800.78 2178.17,1800.78 2123.96,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M2178.17 1724.54 L2178.17 1800.78 L2232.37 1800.78 L2232.37 1724.54 L2178.17 1724.54 L2178.17 1724.54  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2178.17,1724.54 2178.17,1800.78 2232.37,1800.78 2232.37,1724.54 2178.17,1724.54 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M2232.37 1800.78 L2232.37 1800.78 L2286.58 1800.78 L2286.58 1800.78 L2232.37 1800.78 L2232.37 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2232.37,1800.78 2232.37,1800.78 2286.58,1800.78 2232.37,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M2286.58 1800.78 L2286.58 1800.78 L2340.79 1800.78 L2340.79 1800.78 L2286.58 1800.78 L2286.58 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2286.58,1800.78 2286.58,1800.78 2340.79,1800.78 2286.58,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M2340.79 1724.54 L2340.79 1800.78 L2394.99 1800.78 L2394.99 1724.54 L2340.79 1724.54 L2340.79 1724.54  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2340.79,1724.54 2340.79,1800.78 2394.99,1800.78 2394.99,1724.54 2340.79,1724.54 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M2394.99 1800.78 L2394.99 1800.78 L2449.2 1800.78 L2449.2 1800.78 L2394.99 1800.78 L2394.99 1800.78  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2394.99,1800.78 2394.99,1800.78 2449.2,1800.78 2394.99,1800.78 \"/>\n<path clip-path=\"url(#clip312)\" d=\"M2449.2 1724.54 L2449.2 1800.78 L2503.41 1800.78 L2503.41 1724.54 L2449.2 1724.54 L2449.2 1724.54  Z\" fill=\"#009af9\" fill-rule=\"evenodd\" fill-opacity=\"1\"/>\n<polyline clip-path=\"url(#clip312)\" style=\"stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none\" points=\"2449.2,1724.54 2449.2,1800.78 2503.41,1800.78 2503.41,1724.54 2449.2,1724.54 \"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"308.028\" cy=\"1114.61\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"362.235\" cy=\"275.966\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"416.442\" cy=\"47.2441\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"470.649\" cy=\"885.891\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"524.856\" cy=\"1190.85\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"579.063\" cy=\"1114.61\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"633.27\" cy=\"1495.82\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"687.476\" cy=\"1114.61\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"741.683\" cy=\"1114.61\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"795.89\" cy=\"1267.09\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"850.097\" cy=\"1572.06\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"904.304\" cy=\"1495.82\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"958.511\" cy=\"1419.58\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1012.72\" cy=\"1038.37\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1066.92\" cy=\"1190.85\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1121.13\" cy=\"1572.06\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1175.34\" cy=\"1572.06\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1229.55\" cy=\"1724.54\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1283.75\" cy=\"1572.06\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1337.96\" cy=\"1572.06\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1392.17\" cy=\"1419.58\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1446.37\" cy=\"1648.3\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1500.58\" cy=\"1572.06\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1554.79\" cy=\"1724.54\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1608.99\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1663.2\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1717.41\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1771.61\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1825.82\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1880.03\" cy=\"1724.54\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1934.23\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"1988.44\" cy=\"1724.54\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"2042.65\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"2096.86\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"2151.06\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"2205.27\" cy=\"1724.54\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"2259.48\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"2313.68\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"2367.89\" cy=\"1724.54\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"2422.1\" cy=\"1800.78\" r=\"2\"/>\n<circle clip-path=\"url(#clip312)\" style=\"fill:#009af9; stroke:none; fill-opacity:0\" cx=\"2476.3\" cy=\"1724.54\" r=\"2\"/>\n</svg>\n```\n:::\n:::\n\n\n## 6\n\n::: {.cell execution_count=20}\n``` {.julia .cell-code}\ndata_2016 = data[data.year .== 2016, :];\ndata_2016 = leftjoin(data_2016, pred_mc_df, on = [\"Maker\", \"Name\"]);\ndropmissing!(data_2016);\n\ndata_2016[data_2016.Maker .== \"Honda\", :Maker] .= \"Nippyo\";\ndata_2016[data_2016.Maker .== \"Nissan\", :Maker] .= \"BrandA\";\ndata_2016[data_2016.Maker .== \"Subaru\", :Maker] .= \"BrandB\";\ndata_2016[data_2016.Maker .== \"Toyota\", :Maker] .= \"BrandC\";\n\ndata_2016[!, :MakerNippyoA] = data_2016[:, :Maker];\ndata_2016[!, :MakerNippyoB] = data_2016[:, :Maker];\ndata_2016[in([\"Nippyo\", \"BrandA\"]).(data_2016[:, :Maker]), :MakerNippyoA] .= \"NippyoA\";\ndata_2016[in([\"Nippyo\", \"BrandB\"]).(data_2016[:, :Maker]), :MakerNippyoB] .= \"NippyoB\";\nJ = nrow(data_2016);\n\nOwnership_true = data_2016.Maker .== permutedims(data_2016.Maker);\nOwnership_NippyoA = data_2016.MakerNippyoA .== permutedims(data_2016.MakerNippyoA);\nOwnership_NippyoB = data_2016.MakerNippyoB .== permutedims(data_2016.MakerNippyoB);\n```\n:::\n\n\n## 6.4\n\n::: {.cell execution_count=21}\n``` {.julia .cell-code}\nmc = data_2016.MC;\ndatalist_2016 = datalist_struct(\n    X1[data.year .== 2016, :],\n    X2[data.year .== 2016, :],\n    Z[data.year .== 2016, :],\n    data_2016.share,\n    data_2016.year,\n    data_2016.logit_share,\n    datalist.draw_vec,\n    datalist.mkt_denom_d[data.year .== 2016, :]\n);\n```\n:::\n\n\n::: {.cell execution_count=22}\n``` {.julia .cell-code}\nfunction f_update(\n        datalist::datalist_struct,\n        p_old::Vector{Float64},\n        Ownership::BitMatrix,\n        parameter::parameter_struct,\n        theta1::Vector{Float64},\n        theta2::Vector{Float64},\n        mc::Vector{Float64},\n        Xi::Vector{Float64}\n    )\n    \n    X1_new = datalist.X1[:, :];\n    X2_new = reshape(p_old, (:, 1));\n    X1_new[:, 2] .= p_old;\n    \n    delta = (X1_new * theta1) .+ Xi;\n    datalist_new = datalist_struct(\n        X1_new, X2_new, datalist.Z, datalist.ShareVec, datalist.marketindex, \n        datalist.logitshare, datalist.draw_vec, datalist.mkt_denom_d\n        );\n    Sharevec = f_mktshare(\n        theta2, datalist_new, parameter, delta\n    );\n    \n    # elasticity\n    mu = datalist_new.X2 * Diagonal(theta2) * datalist_new.draw_vec;\n    delta_mu = delta .+ mu;\n    exp_delta_mu = exp.(delta_mu);\n    denom_outside = exp.(0.0);\n    denom_temp = (exp_delta_mu' * datalist_new.mkt_denom_d)' .+ denom_outside;\n    denom = datalist_new.mkt_denom_d * denom_temp;\n\n    s_jt_i = exp_delta_mu ./ denom;\n    draw_for_price = datalist_new.draw_vec[1,:];\n    alpha_i = theta1[2] .+ theta2[1] .* draw_for_price;\n    \n    J = size(X1_new, 1);\n    \n    ag_model_s = mean(s_jt_i, dims = 2);\n    elasmat = zeros((J, J));\n\n    for k in 1:J, j in 1:J\n        if (k != j)\n            elasmat[k, j] = (-1.0) .* p_old[k] ./ ag_model_s[j] * mean(alpha_i .* s_jt_i[j, :] .* s_jt_i[k, :])\n        elseif (k == j)\n            elasmat[k, j] = p_old[j] ./ ag_model_s[j] * mean(alpha_i .* s_jt_i[j, :] .* (1.0 .- s_jt_i[j, :]))\n        end\n    end\n\n    Derivative = - elasmat .* Sharevec' ./ p_old;\n    Delta = Derivative .* Ownership;\n    p_new = mc .+ (Delta \\ Sharevec)\n\n    return p_new\n    \nend\n```\n\n::: {.cell-output .cell-output-display execution_count=19}\n```\nf_update (generic function with 1 method)\n```\n:::\n:::\n\n\n\n\n::: {.cell execution_count=24}\n``` {.julia .cell-code}\nfunction f_eqprice(\n        datalist::datalist_struct,\n        p_ini::Vector{Float64},\n        Ownership::BitMatrix,\n        parameter::parameter_struct,\n        theta1::Vector{Float64},\n        theta2::Vector{Float64},\n        mc::Vector{Float64},\n        Xi::Vector{Float64}\n    )\n    \n    lambda = 1e-6;\n    p_old = p_ini;\n    distance = 10000;\n    \n    local p_new\n    \n    while (distance > lambda)\n        p_new = f_update(datalist, p_old, Ownership, parameter, theta1, theta2, mc, Xi);\n        distance = maximum(abs.(p_new - p_old));\n        p_old = p_new[:];\n        # print(distance, \"\\n\")\n    end\n    \n    return p_new\nend\n```\n\n::: {.cell-output .cell-output-display execution_count=20}\n```\nf_eqprice (generic function with 1 method)\n```\n:::\n:::\n\n\n\n\n## 6.5\n\n::: {.cell execution_count=26}\n``` {.julia .cell-code}\np_ini = data_2016.price;\np_NippyoA = f_eqprice(\n    datalist_2016,\n    p_ini,\n    Ownership_NippyoA,\n    parameter,\n    beta_hat,\n    gmm_res.minimizer,\n    mc,\n    Xi[data.year .== 2016]\n);\n\np_ini = data_2016.price;\np_NippyoB = f_eqprice(\n    datalist_2016,\n    p_ini,\n    Ownership_NippyoB,\n    parameter,\n    beta_hat,\n    gmm_res.minimizer,\n    mc,\n    Xi[data.year .== 2016]\n);\n```\n:::\n\n\n::: {.cell execution_count=27}\n``` {.julia .cell-code}\nfunction f_mktshare_sim(\n        datalist::datalist_struct,\n        p::Vector{Float64},\n        parameter::parameter_struct,\n        theta1::Vector{Float64},\n        theta2::Vector{Float64},\n        Xi::Vector{Float64}\n    )\n    \n    X1_new = datalist.X1[:, :];\n    X2_new = reshape(p[:], (:, 1));\n    X1_new[:, 2] .= p;\n    \n    delta = (X1_new * theta1) .+ Xi;\n    datalist_new = datalist_struct(\n        X1_new, X2_new, datalist.Z, datalist.ShareVec, datalist.marketindex, \n        datalist.logitshare, datalist.draw_vec, datalist.mkt_denom_d\n        );\n    Sharevec = f_mktshare(\n        theta2, datalist_new, parameter, delta\n    );\n    \n    return(Sharevec)\n    \nend\n```\n\n::: {.cell-output .cell-output-display execution_count=22}\n```\nf_mktshare_sim (generic function with 1 method)\n```\n:::\n:::\n\n\n## 7\n\n## 7.1\n\n::: {.cell execution_count=28}\n``` {.julia .cell-code}\nmerger_sim_df = DataFrame(\n    Maker = data_2016.Maker, \n    Name = data_2016.Name, \n    Price_A = (p_NippyoA .- data_2016.price) ./ data_2016.price .* 100.0,\n    Share_A = (f_mktshare_sim(\n                datalist_2016,\n                p_NippyoA,\n                parameter,\n                beta_hat,\n                gmm_res.minimizer,\n                Xi[data.year .== 2016]\n            ) .- data_2016.share) ./ data_2016.share .* 100.0,\n    Price_B = (p_NippyoB .- data_2016.price) ./ data_2016.price .* 100.0,\n    Share_B = (f_mktshare_sim(\n                datalist_2016,\n                p_NippyoB,\n                parameter,\n                beta_hat,\n                gmm_res.minimizer,\n                Xi[data.year .== 2016]\n            ) .- data_2016.share) ./ data_2016.share .* 100.0,\n);\n\nmerger_sim_df[in([\"Nippyo\", \"BrandA\", \"BrandB\", \"BrandC\"]).(merger_sim_df.Maker), :]\n```\n\n::: {.cell-output .cell-output-display execution_count=23}\n```{=html}\n<div><div style = \"float: left;\"><span>92×6 DataFrame</span></div><div style = \"float: right;\"><span style = \"font-style: italic;\">67 rows omitted</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Maker</th><th style = \"text-align: left;\">Name</th><th style = \"text-align: left;\">Price_A</th><th style = \"text-align: left;\">Share_A</th><th style = \"text-align: left;\">Price_B</th><th style = \"text-align: left;\">Share_B</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String15\" style = \"text-align: left;\">String15</th><th title = \"String31\" style = \"text-align: left;\">String31</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">N-WGN</td><td style = \"text-align: right;\">0.528904</td><td style = \"text-align: right;\">-1.08573</td><td style = \"text-align: right;\">0.200634</td><td style = \"text-align: right;\">-0.412253</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">N-ONE</td><td style = \"text-align: right;\">0.525627</td><td style = \"text-align: right;\">-1.09385</td><td style = \"text-align: right;\">0.199727</td><td style = \"text-align: right;\">-0.416064</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">N-BOX</td><td style = \"text-align: right;\">0.514136</td><td style = \"text-align: right;\">-1.12708</td><td style = \"text-align: right;\">0.196685</td><td style = \"text-align: right;\">-0.431724</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">フィット</td><td style = \"text-align: right;\">0.510693</td><td style = \"text-align: right;\">-1.13894</td><td style = \"text-align: right;\">0.19583</td><td style = \"text-align: right;\">-0.43734</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">バモス</td><td style = \"text-align: right;\">0.503396</td><td style = \"text-align: right;\">-1.16852</td><td style = \"text-align: right;\">0.194146</td><td style = \"text-align: right;\">-0.451391</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">シャトル</td><td style = \"text-align: right;\">0.486998</td><td style = \"text-align: right;\">-1.3015</td><td style = \"text-align: right;\">0.192368</td><td style = \"text-align: right;\">-0.515434</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">グレイス</td><td style = \"text-align: right;\">0.486127</td><td style = \"text-align: right;\">-1.32499</td><td style = \"text-align: right;\">0.192777</td><td style = \"text-align: right;\">-0.526882</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">フリード</td><td style = \"text-align: right;\">0.485831</td><td style = \"text-align: right;\">-1.38128</td><td style = \"text-align: right;\">0.194403</td><td style = \"text-align: right;\">-0.55445</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">ヴェゼル</td><td style = \"text-align: right;\">0.486195</td><td style = \"text-align: right;\">-1.3988</td><td style = \"text-align: right;\">0.195076</td><td style = \"text-align: right;\">-0.563071</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">S660</td><td style = \"text-align: right;\">0.48711</td><td style = \"text-align: right;\">-1.42526</td><td style = \"text-align: right;\">0.196225</td><td style = \"text-align: right;\">-0.576117</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">11</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">ステップワゴン</td><td style = \"text-align: right;\">0.497936</td><td style = \"text-align: right;\">-1.56393</td><td style = \"text-align: right;\">0.204493</td><td style = \"text-align: right;\">-0.645058</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">12</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">CR-V</td><td style = \"text-align: right;\">0.5085</td><td style = \"text-align: right;\">-1.64777</td><td style = \"text-align: right;\">0.211013</td><td style = \"text-align: right;\">-0.687093</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">13</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">ジェイド</td><td style = \"text-align: right;\">0.51258</td><td style = \"text-align: right;\">-1.67565</td><td style = \"text-align: right;\">0.213399</td><td style = \"text-align: right;\">-0.701116</td></tr><tr><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">81</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">エスクァイア</td><td style = \"text-align: right;\">0.00505423</td><td style = \"text-align: right;\">0.0455417</td><td style = \"text-align: right;\">0.00243967</td><td style = \"text-align: right;\">0.0185788</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">82</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">ハイエースワゴン</td><td style = \"text-align: right;\">0.00505213</td><td style = \"text-align: right;\">0.0459376</td><td style = \"text-align: right;\">0.0024417</td><td style = \"text-align: right;\">0.0187698</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">83</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">ハリアー</td><td style = \"text-align: right;\">0.0050453</td><td style = \"text-align: right;\">0.0466928</td><td style = \"text-align: right;\">0.00244393</td><td style = \"text-align: right;\">0.0191362</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">84</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">アルファード</td><td style = \"text-align: right;\">0.00495413</td><td style = \"text-align: right;\">0.0499348</td><td style = \"text-align: right;\">0.00241818</td><td style = \"text-align: right;\">0.0207371</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">85</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">ヴェルファイア</td><td style = \"text-align: right;\">0.00495413</td><td style = \"text-align: right;\">0.0499348</td><td style = \"text-align: right;\">0.00241818</td><td style = \"text-align: right;\">0.0207371</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">86</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">カムリ</td><td style = \"text-align: right;\">0.00495022</td><td style = \"text-align: right;\">0.0500152</td><td style = \"text-align: right;\">0.0024166</td><td style = \"text-align: right;\">0.0207774</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">87</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">FJクルーザー</td><td style = \"text-align: right;\">0.00493705</td><td style = \"text-align: right;\">0.0502725</td><td style = \"text-align: right;\">0.00241121</td><td style = \"text-align: right;\">0.0209066</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">88</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">エスティマ</td><td style = \"text-align: right;\">0.00492334</td><td style = \"text-align: right;\">0.0505216</td><td style = \"text-align: right;\">0.00240544</td><td style = \"text-align: right;\">0.021032</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">89</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">SAI</td><td style = \"text-align: right;\">0.0049077</td><td style = \"text-align: right;\">0.0507866</td><td style = \"text-align: right;\">0.00239871</td><td style = \"text-align: right;\">0.0211657</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">90</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">クラウン</td><td style = \"text-align: right;\">0.00450612</td><td style = \"text-align: right;\">0.0548772</td><td style = \"text-align: right;\">0.00220451</td><td style = \"text-align: right;\">0.0232696</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">91</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">ランドクルーザー</td><td style = \"text-align: right;\">0.00284137</td><td style = \"text-align: right;\">0.0624546</td><td style = \"text-align: right;\">0.00132154</td><td style = \"text-align: right;\">0.027341</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">92</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">センチュリー</td><td style = \"text-align: right;\">-0.00246452</td><td style = \"text-align: right;\">0.0523554</td><td style = \"text-align: right;\">-0.00159183</td><td style = \"text-align: right;\">0.0219765</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## 7.2\n\n::: {.cell execution_count=29}\n``` {.julia .cell-code}\nPricevec = data_2016.price;\nSharevec = data_2016.share;\nOwnership = data_2016.MakerNippyoA .== permutedims(data_2016.MakerNippyoA);\nDerivative = - elasmat_t .* Sharevec' ./ Pricevec;\nDelta = Derivative .* Ownership;\nmc_NippyoA_pfix = Pricevec - (Delta \\ Sharevec);\nOwnership = data_2016.MakerNippyoB .== permutedims(data_2016.MakerNippyoB);\nDerivative = - elasmat_t .* Sharevec' ./ Pricevec;\nDelta = Derivative .* Ownership;\nmc_NippyoB_pfix = Pricevec - (Delta \\ Sharevec);\nmc_sim_df = DataFrame(\n    Maker = data_2016.Maker, \n    Name = data_2016.Name, \n    Nippyo_and_Brand_A = (mc_NippyoA_pfix .- mc) ./ mc .* 100.0,\n    Nippyo_and_Brand_B = (mc_NippyoB_pfix .- mc) ./ mc .* 100.0,\n);\n\nmc_sim_df[in([\"Nippyo\", \"BrandA\", \"BrandB\", \"BrandC\"]).(mc_sim_df.Maker), :]\n```\n\n::: {.cell-output .cell-output-display execution_count=24}\n```{=html}\n<div><div style = \"float: left;\"><span>92×4 DataFrame</span></div><div style = \"float: right;\"><span style = \"font-style: italic;\">67 rows omitted</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Maker</th><th style = \"text-align: left;\">Name</th><th style = \"text-align: left;\">Nippyo_and_Brand_A</th><th style = \"text-align: left;\">Nippyo_and_Brand_B</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String15\" style = \"text-align: left;\">String15</th><th title = \"String31\" style = \"text-align: left;\">String31</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">N-WGN</td><td style = \"text-align: right;\">-0.913246</td><td style = \"text-align: right;\">-0.347271</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">N-ONE</td><td style = \"text-align: right;\">-0.895623</td><td style = \"text-align: right;\">-0.341138</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">N-BOX</td><td style = \"text-align: right;\">-0.83478</td><td style = \"text-align: right;\">-0.320098</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">フィット</td><td style = \"text-align: right;\">-0.816657</td><td style = \"text-align: right;\">-0.313882</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">バモス</td><td style = \"text-align: right;\">-0.777854</td><td style = \"text-align: right;\">-0.300681</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">シャトル</td><td style = \"text-align: right;\">-0.672993</td><td style = \"text-align: right;\">-0.266414</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">グレイス</td><td style = \"text-align: right;\">-0.661754</td><td style = \"text-align: right;\">-0.262989</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">フリード</td><td style = \"text-align: right;\">-0.640238</td><td style = \"text-align: right;\">-0.256743</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">ヴェゼル</td><td style = \"text-align: right;\">-0.63483</td><td style = \"text-align: right;\">-0.255265</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">S660</td><td style = \"text-align: right;\">-0.627628</td><td style = \"text-align: right;\">-0.253382</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">11</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">ステップワゴン</td><td style = \"text-align: right;\">-0.604134</td><td style = \"text-align: right;\">-0.248681</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">12</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">CR-V</td><td style = \"text-align: right;\">-0.598054</td><td style = \"text-align: right;\">-0.248784</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">13</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: left;\">ジェイド</td><td style = \"text-align: right;\">-0.596997</td><td style = \"text-align: right;\">-0.249167</td></tr><tr><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td><td style = \"text-align: right;\">&vellip;</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">81</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">エスクァイア</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">82</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">ハイエースワゴン</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">83</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">ハリアー</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">84</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">アルファード</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">85</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">ヴェルファイア</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">86</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">カムリ</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">87</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">FJクルーザー</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">88</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">エスティマ</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">89</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">SAI</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">90</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">クラウン</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">91</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">ランドクルーザー</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">92</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: left;\">センチュリー</td><td style = \"text-align: right;\">0.0</td><td style = \"text-align: right;\">0.0</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## 7.4\n\n\n\n::: {.cell execution_count=31}\n``` {.julia .cell-code}\nalpha_i = - (beta_hat[2] .+ gmm_res.minimizer[1] * draw_for_price)\ndata_2016.HH[1]\n```\n\n::: {.cell-output .cell-output-display execution_count=25}\n```\n56950757\n```\n:::\n:::\n\n\n::: {.cell execution_count=32}\n``` {.julia .cell-code}\nfunction f_CS(\n        datalist::datalist_struct,\n        p::Vector{Float64},\n        parameter::parameter_struct,\n        theta1::Vector{Float64},\n        theta2::Vector{Float64},\n        Xi::Vector{Float64},\n        HH::Int64\n    )\n    \n    X1_new = datalist.X1[:, :];\n    X2_new = reshape(p, (:, 1));\n    X1_new[:, 2] .= p;\n    \n    delta = (X1_new * theta1) .+ Xi;\n    \n    # elasticity\n    mu = X2_new * Diagonal(theta2) * datalist.draw_vec;\n    \n    V = delta .+ mu;\n    exp_V = exp.(V);\n    \n    numerator = log.(vec(sum(exp_V, dims = 1)) .+ 1.0);\n    \n    draw_for_price = datalist.draw_vec[1,:];\n    alpha_i = - (theta1[2] .+ theta2[1] .* draw_for_price);\n    \n    CS = mean(numerator ./ alpha_i) .* HH;\n\n    return CS\n    \nend\n\nCS_2016 = f_CS(\n    datalist_2016, \n    data_2016.price, \n    parameter, \n    beta_hat, \n    gmm_res.minimizer, \n    Xi[data.year .== 2016], \n    data_2016.HH[1]\n);\n\nCS_NippyoA = f_CS(\n    datalist_2016, \n    p_NippyoA, \n    parameter, \n    beta_hat, \n    gmm_res.minimizer, \n    Xi[data.year .== 2016], \n    data_2016.HH[1]\n);\n\nCS_NippyoB = f_CS(\n    datalist_2016, \n    p_NippyoB, \n    parameter, \n    beta_hat, \n    gmm_res.minimizer, \n    Xi[data.year .== 2016], \n    data_2016.HH[1]\n);\n\nCV_NippyoA = CS_NippyoA - CS_2016;\nCV_NippyoB = CS_NippyoB - CS_2016;\n```\n:::\n\n\n::: {.cell execution_count=33}\n``` {.julia .cell-code}\nf_profit = function(\n        Maker::AbstractVector, \n        price::Vector{Float64}, \n        mc::Vector{Float64}, \n        share::Vector{Float64}, \n        HH::Vector{Int64}\n    )\n    \n    dt = DataFrame(\n        Maker = Maker,\n        price = price,\n        mc = mc,\n        share = share,\n        HH = HH,\n        profit = (price - mc) .* share .* HH,\n        revenue = price.* share .* HH\n    )\n    \n    return(combine(groupby(dt, :Maker), [:profit, :revenue] .=> sum .=> [:profit, :revenue]))\nend\n```\n\n::: {.cell-output .cell-output-display execution_count=27}\n```\n#27 (generic function with 1 method)\n```\n:::\n:::\n\n\n::: {.cell execution_count=34}\n``` {.julia .cell-code}\npro_rev_2016 = f_profit(\n    data_2016.Maker,\n    data_2016.price,\n    mc,\n    data_2016.share,\n    data_2016.HH\n);\npro_rev_NippyoA = f_profit(\n    data_2016.Maker,\n    p_NippyoA,\n    mc,\n    f_mktshare_sim(\n                datalist_2016,\n                p_NippyoA,\n                parameter,\n                beta_hat,\n                gmm_res.minimizer,\n                Xi[data.year .== 2016]\n            ),\n    data_2016.HH\n);\npro_rev_NippyoB = f_profit(\n    data_2016.Maker,\n    p_NippyoB,\n    mc,\n    f_mktshare_sim(\n                datalist_2016,\n                p_NippyoB,\n                parameter,\n                beta_hat,\n                gmm_res.minimizer,\n                Xi[data.year .== 2016]\n            ),\n    data_2016.HH\n);\n\nTS_change_NippyoA = CV_NippyoA + sum(pro_rev_NippyoA.profit - pro_rev_2016.profit);\nTS_change_NippyoB = CV_NippyoB + sum(pro_rev_NippyoB.profit - pro_rev_2016.profit);\n```\n:::\n\n\n::: {.cell execution_count=35}\n``` {.julia .cell-code}\nDataFrame(\n    Measure = [\"Consumer surplus\", \"Total welfare\"],\n    Nippyo_and_Brand_A = [CV_NippyoA, TS_change_NippyoA],\n    Nippyo_and_Brand_B = [CV_NippyoB, TS_change_NippyoB],\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=29}\n```{=html}\n<div><div style = \"float: left;\"><span>2×3 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Measure</th><th style = \"text-align: left;\">Nippyo_and_Brand_A</th><th style = \"text-align: left;\">Nippyo_and_Brand_B</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String\" style = \"text-align: left;\">String</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Consumer surplus</td><td style = \"text-align: right;\">-11486.1</td><td style = \"text-align: right;\">-4617.72</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">Total welfare</td><td style = \"text-align: right;\">-10275.0</td><td style = \"text-align: right;\">-4082.23</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=36}\n``` {.julia .cell-code}\nresult_df = DataFrame(\n    Maker = pro_rev_2016.Maker,\n    Profits_NippyoA = pro_rev_NippyoA.profit - pro_rev_2016.profit,\n    Revenue_NippyoA = pro_rev_NippyoA.revenue - pro_rev_2016.revenue,\n    Profits_NippyoB = pro_rev_NippyoB.profit - pro_rev_2016.profit,\n    Revenue_NippyoB = pro_rev_NippyoB.revenue - pro_rev_2016.revenue,\n);\n\ntotal_df = combine(result_df, 2:5 .=> sum .=> names(result_df)[2:5]);\ntotal_df[!, :Maker] .= \"Total\"\nappend!(result_df, total_df)\n```\n\n::: {.cell-output .cell-output-display execution_count=30}\n```{=html}\n<div><div style = \"float: left;\"><span>16×5 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Maker</th><th style = \"text-align: left;\">Profits_NippyoA</th><th style = \"text-align: left;\">Revenue_NippyoA</th><th style = \"text-align: left;\">Profits_NippyoB</th><th style = \"text-align: left;\">Revenue_NippyoB</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String15\" style = \"text-align: left;\">String15</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Audi</td><td style = \"text-align: right;\">11.42</td><td style = \"text-align: right;\">39.3669</td><td style = \"text-align: right;\">5.00774</td><td style = \"text-align: right;\">17.2094</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">BMW</td><td style = \"text-align: right;\">37.8657</td><td style = \"text-align: right;\">123.311</td><td style = \"text-align: right;\">16.4744</td><td style = \"text-align: right;\">52.9189</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">Daihatsu</td><td style = \"text-align: right;\">108.936</td><td style = \"text-align: right;\">208.968</td><td style = \"text-align: right;\">44.2344</td><td style = \"text-align: right;\">83.5685</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">Fiat</td><td style = \"text-align: right;\">1.52418</td><td style = \"text-align: right;\">4.14223</td><td style = \"text-align: right;\">0.639666</td><td style = \"text-align: right;\">1.70164</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">Lexas</td><td style = \"text-align: right;\">59.8269</td><td style = \"text-align: right;\">199.098</td><td style = \"text-align: right;\">25.9303</td><td style = \"text-align: right;\">87.8</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">Matsuda</td><td style = \"text-align: right;\">59.4818</td><td style = \"text-align: right;\">151.83</td><td style = \"text-align: right;\">24.8492</td><td style = \"text-align: right;\">62.3322</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">Mercedes</td><td style = \"text-align: right;\">52.2646</td><td style = \"text-align: right;\">174.885</td><td style = \"text-align: right;\">22.6072</td><td style = \"text-align: right;\">77.1302</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">Mitsubishi</td><td style = \"text-align: right;\">20.5141</td><td style = \"text-align: right;\">50.3782</td><td style = \"text-align: right;\">8.53346</td><td style = \"text-align: right;\">20.6598</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">Suzuki</td><td style = \"text-align: right;\">114.119</td><td style = \"text-align: right;\">216.394</td><td style = \"text-align: right;\">46.3145</td><td style = \"text-align: right;\">86.5724</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: left;\">Volkswagen</td><td style = \"text-align: right;\">19.5327</td><td style = \"text-align: right;\">58.8824</td><td style = \"text-align: right;\">8.34637</td><td style = \"text-align: right;\">24.6511</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">11</td><td style = \"text-align: left;\">Volvo</td><td style = \"text-align: right;\">9.3833</td><td style = \"text-align: right;\">32.0072</td><td style = \"text-align: right;\">4.1136</td><td style = \"text-align: right;\">13.8844</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">12</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: right;\">78.9811</td><td style = \"text-align: right;\">-9184.5</td><td style = \"text-align: right;\">42.7737</td><td style = \"text-align: right;\">-3672.28</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">13</td><td style = \"text-align: left;\">BrandA</td><td style = \"text-align: right;\">14.0327</td><td style = \"text-align: right;\">-10407.1</td><td style = \"text-align: right;\">57.2739</td><td style = \"text-align: right;\">142.533</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">14</td><td style = \"text-align: left;\">BrandB</td><td style = \"text-align: right;\">55.1002</td><td style = \"text-align: right;\">153.123</td><td style = \"text-align: right;\">-12.0312</td><td style = \"text-align: right;\">-4885.14</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: right;\">568.091</td><td style = \"text-align: right;\">1412.74</td><td style = \"text-align: right;\">240.429</td><td style = \"text-align: right;\">584.277</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">16</td><td style = \"text-align: left;\">Total</td><td style = \"text-align: right;\">1211.07</td><td style = \"text-align: right;\">-16766.5</td><td style = \"text-align: right;\">535.496</td><td style = \"text-align: right;\">-7302.18</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## 8\n\n::: {.cell execution_count=37}\n``` {.julia .cell-code}\nfunction f_effect_cost_reduction(\n        cost_red::Float64,\n        cost_red_firm::AbstractVector,\n        Ownership::BitMatrix,\n        data::DataFrame,\n        mc::Vector{Float64},\n        datalist::datalist_struct,\n        parameter::parameter_struct,\n        theta1::Vector{Float64},\n        theta2::Vector{Float64},\n        HH::Vector{Int64},\n        p_pre::Vector{Float64},\n        pro_rev_pre::DataFrame,\n        CS_pre::Float64,\n        Xi::Vector{Float64}\n    )\n   \n    mc_new = mc[:];\n    mc_new[in(cost_red_firm).(data.Maker)] = mc_new[in(cost_red_firm).(data.Maker)] .* cost_red;\n    \n    p_post = f_eqprice(datalist, p_pre, Ownership, parameter, theta1, theta2, mc_new, Xi);\n    \n    CV = f_CS(datalist, p_post, parameter, theta1, theta2, Xi, HH[1]) - CS_pre;\n    \n    share_post = f_mktshare_sim(datalist, p_post, parameter, theta1, theta2, Xi);\n    pro_rev_post = f_profit(data.Maker, p_post, mc, share_post, HH);\n    \n    TS_change = CV + sum(pro_rev_post.profit .- pro_rev_pre.profit);\n    return TS_change\n    \nend\n```\n\n::: {.cell-output .cell-output-display execution_count=31}\n```\nf_effect_cost_reduction (generic function with 1 method)\n```\n:::\n:::\n\n\n## 8.2\n\n::: {.cell execution_count=38}\n``` {.julia .cell-code}\ncost_red_firm = [\"Nippyo\", \"Brand_A\"];\ndistance = 100\nlambda = 1e-6;\nmax_cost_red = 1.0;\nmin_cost_red = 0.0;\n\niter = 1;\n```\n:::\n\n\n::: {.cell execution_count=39}\n``` {.julia .cell-code}\n@time while (distance > lambda) & (iter < 100)\n    \n    mid_cost_red = (max_cost_red + min_cost_red) / 2.0;\n    \n    mid_eval = f_effect_cost_reduction(\n        mid_cost_red,\n        cost_red_firm,\n        Ownership_NippyoA,\n        data_2016,\n        mc,\n        datalist_2016,\n        parameter,\n        beta_hat,\n        gmm_res.minimizer,\n        data_2016.HH,\n        p_NippyoA,\n        pro_rev_2016,\n        CS_2016,\n        Xi[data.year .== 2016]\n    );\n    \n    if mid_eval > 0\n        min_cost_red = mid_cost_red;\n    else\n        max_cost_red = mid_cost_red;\n    end\n    \n    distance = abs(mid_eval - 0);\n    print(distance, \"\\n\")\n#     print(min_cost_red, \",\", max_cost_red, \",\", mid_cost_red, \"\\n\")\n    iter += 1\n    \nend\ncost_red_NippyoA = (min_cost_red + min_cost_red) / 2.0;\n```\n:::\n\n\n\n\n::: {.cell execution_count=41}\n\n::: {.cell-output .cell-output-display execution_count=33}\n```\n0.9856680991833855\n```\n:::\n:::\n\n\n::: {.cell execution_count=42}\n``` {.julia .cell-code}\nmc_NippyoA_TSfix = mc[:];\nmc_NippyoA_TSfix[in(cost_red_firm).(data_2016.Maker)] = (\n    mc_NippyoA_TSfix[in(cost_red_firm).(data_2016.Maker)] .* cost_red_NippyoA\n    );\n```\n:::\n\n\n::: {.cell execution_count=43}\n``` {.julia .cell-code}\np_NippyoA_TSfix = f_eqprice(\n    datalist_2016, \n    p_NippyoA, \n    Ownership_NippyoA, \n    parameter, \n    beta_hat, \n    gmm_res.minimizer, \n    mc_NippyoA_TSfix, \n    Xi[data.year .== 2016]\n    );\nshare_NippyoA_TSfix = f_mktshare_sim(\n    datalist_2016, \n    p_NippyoA_TSfix, \n    parameter, \n    beta_hat, \n    gmm_res.minimizer, \n    Xi[data.year .== 2016]\n    );\n```\n:::\n\n\n## 8.3\n\n::: {.cell execution_count=44}\n``` {.julia .cell-code}\ncost_red_firm = [\"Nippyo\", \"Brand_B\"];\ndistance = 100\nlambda = 1e-6;\nmax_cost_red = 1.0;\nmin_cost_red = 0.0;\n\niter = 1;\n```\n:::\n\n\n::: {.cell execution_count=45}\n``` {.julia .cell-code}\n@time while (distance > lambda) & (iter < 100)\n    \n    mid_cost_red = (max_cost_red + min_cost_red) / 2.0;\n    \n    mid_eval = f_effect_cost_reduction(\n        mid_cost_red,\n        cost_red_firm,\n        Ownership_NippyoB,\n        data_2016,\n        mc,\n        datalist_2016,\n        parameter,\n        beta_hat,\n        gmm_res.minimizer,\n        data_2016.HH,\n        p_NippyoB,\n        pro_rev_2016,\n        CS_2016,\n        Xi[data.year .== 2016]\n    );\n    \n    if mid_eval > 0\n        min_cost_red = mid_cost_red;\n    else\n        max_cost_red = mid_cost_red;\n    end\n    \n    distance = abs(mid_eval - 0);\n    print(distance, \"\\n\")\n#     print(min_cost_red, \",\", max_cost_red, \",\", mid_cost_red, \"\\n\")\n    iter += 1\n    \nend\ncost_red_NippyoB = (min_cost_red + min_cost_red) / 2.0;\n```\n:::\n\n\n\n\n::: {.cell execution_count=47}\n\n::: {.cell-output .cell-output-display execution_count=37}\n```\n0.9943264803296188\n```\n:::\n:::\n\n\n::: {.cell execution_count=48}\n``` {.julia .cell-code}\nmc_NippyoB_TSfix = mc[:];\nmc_NippyoB_TSfix[in(cost_red_firm).(data_2016.Maker)] = (\n    mc_NippyoB_TSfix[in(cost_red_firm).(data_2016.Maker)] .* cost_red_NippyoB\n    );\n```\n:::\n\n\n::: {.cell execution_count=49}\n``` {.julia .cell-code}\np_NippyoB_TSfix = f_eqprice(\n    datalist_2016, \n    p_NippyoB, \n    Ownership_NippyoB,\n    parameter, \n    beta_hat, \n    gmm_res.minimizer, \n    mc_NippyoB_TSfix, \n    Xi[data.year .== 2016]\n    );\nshare_NippyoB_TSfix = f_mktshare_sim(\n    datalist_2016, \n    p_NippyoB_TSfix, \n    parameter, \n    beta_hat, \n    gmm_res.minimizer, \n    Xi[data.year .== 2016]\n    );\n```\n:::\n\n\n::: {.cell execution_count=50}\n``` {.julia .cell-code}\n[1 - cost_red_NippyoA 1 - cost_red_NippyoB] .* 100\n```\n\n::: {.cell-output .cell-output-display execution_count=40}\n```\n1×2 Matrix{Float64}:\n 1.43319  0.567352\n```\n:::\n:::\n\n\n## 8.5\n\n::: {.cell execution_count=51}\n``` {.julia .cell-code}\npro_rev_NippyoA_rc = f_profit(\n    data_2016.Maker,\n    p_NippyoA_TSfix,\n    mc_NippyoA_TSfix,\n    share_NippyoA_TSfix,\n    data_2016.HH\n);\npro_rev_NippyoB_rc = f_profit(\n    data_2016.Maker,\n    p_NippyoB_TSfix,\n    mc_NippyoB_TSfix,\n    share_NippyoB_TSfix,\n    data_2016.HH\n);\n\nresult2_df = DataFrame(\n    Maker = pro_rev_2016.Maker,\n    Profits_NippyoA = pro_rev_NippyoA_rc.profit - pro_rev_2016.profit,\n    Revenue_NippyoA = pro_rev_NippyoA_rc.revenue - pro_rev_2016.revenue,\n    Profits_NippyoB = pro_rev_NippyoB_rc.profit - pro_rev_2016.profit,\n    Revenue_NippyoB = pro_rev_NippyoB_rc.revenue - pro_rev_2016.revenue,\n    \n);\n\ntotal2_df = combine(result2_df, 2:5 .=> sum .=> names(result2_df)[2:5]);\ntotal2_df[!, :Maker] .= \"Total\";\nappend!(result2_df, total2_df)\n```\n\n::: {.cell-output .cell-output-display execution_count=41}\n```{=html}\n<div><div style = \"float: left;\"><span>16×5 DataFrame</span></div><div style = \"clear: both;\"></div></div><div class = \"data-frame\" style = \"overflow-x: scroll;\"><table class = \"data-frame\" style = \"margin-bottom: 6px;\"><thead><tr class = \"header\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">Row</th><th style = \"text-align: left;\">Maker</th><th style = \"text-align: left;\">Profits_NippyoA</th><th style = \"text-align: left;\">Revenue_NippyoA</th><th style = \"text-align: left;\">Profits_NippyoB</th><th style = \"text-align: left;\">Revenue_NippyoB</th></tr><tr class = \"subheader headerLastRow\"><th class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\"></th><th title = \"String15\" style = \"text-align: left;\">String15</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th><th title = \"Float64\" style = \"text-align: left;\">Float64</th></tr></thead><tbody><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">1</td><td style = \"text-align: left;\">Audi</td><td style = \"text-align: right;\">0.578278</td><td style = \"text-align: right;\">0.637611</td><td style = \"text-align: right;\">0.709338</td><td style = \"text-align: right;\">1.85086</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">2</td><td style = \"text-align: left;\">BMW</td><td style = \"text-align: right;\">1.16365</td><td style = \"text-align: right;\">0.743377</td><td style = \"text-align: right;\">1.92048</td><td style = \"text-align: right;\">4.30378</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">3</td><td style = \"text-align: left;\">Daihatsu</td><td style = \"text-align: right;\">-1.23683</td><td style = \"text-align: right;\">-3.20943</td><td style = \"text-align: right;\">0.510195</td><td style = \"text-align: right;\">-0.652691</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">4</td><td style = \"text-align: left;\">Fiat</td><td style = \"text-align: right;\">-0.000300335</td><td style = \"text-align: right;\">-0.0395873</td><td style = \"text-align: right;\">0.034865</td><td style = \"text-align: right;\">0.0422145</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">5</td><td style = \"text-align: left;\">Lexas</td><td style = \"text-align: right;\">5.24057</td><td style = \"text-align: right;\">7.2343</td><td style = \"text-align: right;\">4.29229</td><td style = \"text-align: right;\">11.7282</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">6</td><td style = \"text-align: left;\">Matsuda</td><td style = \"text-align: right;\">-0.0455557</td><td style = \"text-align: right;\">-1.40967</td><td style = \"text-align: right;\">1.23194</td><td style = \"text-align: right;\">1.52314</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">7</td><td style = \"text-align: left;\">Mercedes</td><td style = \"text-align: right;\">4.44846</td><td style = \"text-align: right;\">6.19975</td><td style = \"text-align: right;\">3.65229</td><td style = \"text-align: right;\">10.2477</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">8</td><td style = \"text-align: left;\">Mitsubishi</td><td style = \"text-align: right;\">-0.0396423</td><td style = \"text-align: right;\">-0.471821</td><td style = \"text-align: right;\">0.378446</td><td style = \"text-align: right;\">0.481087</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">9</td><td style = \"text-align: left;\">Suzuki</td><td style = \"text-align: right;\">-1.3003</td><td style = \"text-align: right;\">-3.30166</td><td style = \"text-align: right;\">0.50768</td><td style = \"text-align: right;\">-0.632405</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">10</td><td style = \"text-align: left;\">Volkswagen</td><td style = \"text-align: right;\">0.208558</td><td style = \"text-align: right;\">-0.216559</td><td style = \"text-align: right;\">0.681591</td><td style = \"text-align: right;\">1.20412</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">11</td><td style = \"text-align: left;\">Volvo</td><td style = \"text-align: right;\">0.380303</td><td style = \"text-align: right;\">0.354901</td><td style = \"text-align: right;\">0.543972</td><td style = \"text-align: right;\">1.33128</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">12</td><td style = \"text-align: left;\">Nippyo</td><td style = \"text-align: right;\">9976.91</td><td style = \"text-align: right;\">10995.0</td><td style = \"text-align: right;\">3925.25</td><td style = \"text-align: right;\">4286.01</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">13</td><td style = \"text-align: left;\">BrandA</td><td style = \"text-align: right;\">-125.931</td><td style = \"text-align: right;\">-10955.2</td><td style = \"text-align: right;\">3.06225</td><td style = \"text-align: right;\">4.28647</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">14</td><td style = \"text-align: left;\">BrandB</td><td style = \"text-align: right;\">0.323965</td><td style = \"text-align: right;\">-0.879382</td><td style = \"text-align: right;\">-34.1722</td><td style = \"text-align: right;\">-4980.65</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">15</td><td style = \"text-align: left;\">BrandC</td><td style = \"text-align: right;\">4.27964</td><td style = \"text-align: right;\">-11.8808</td><td style = \"text-align: right;\">16.7721</td><td style = \"text-align: right;\">18.9825</td></tr><tr><td class = \"rowNumber\" style = \"font-weight: bold; text-align: right;\">16</td><td style = \"text-align: left;\">Total</td><td style = \"text-align: right;\">9864.98</td><td style = \"text-align: right;\">33.5695</td><td style = \"text-align: right;\">3925.37</td><td style = \"text-align: right;\">-639.946</td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## 8.6\n\n::: {.cell execution_count=52}\n``` {.julia .cell-code}\nprint(\"Change in profit by Brand A merger (%): \", (sum(pro_rev_NippyoA_rc.profit) .- sum(pro_rev_2016.profit)) ./ sum(pro_rev_2016.profit) .* 100.0, \"\\n\")\nprint(\"Change in revenue by Brand A merger (%): \", (sum(pro_rev_NippyoA_rc.revenue) .- sum(pro_rev_2016.revenue)) ./ sum(pro_rev_2016.revenue) .* 100.0, \"\\n\")\nprint(\"Change in profit by Brand B merger (%): \", (sum(pro_rev_NippyoB_rc.profit) .- sum(pro_rev_2016.profit)) ./ sum(pro_rev_2016.profit) .* 100.0, \"\\n\")\nprint(\"Change in revenue by Brand B merger (%): \", (sum(pro_rev_NippyoB_rc.revenue) .- sum(pro_rev_2016.revenue)) ./ sum(pro_rev_2016.revenue) .* 100.0, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nChange in profit by Brand A merger (%): 0.36380146936382757\nChange in revenue by Brand A merger (%): 0.00044982645552334383\nChange in profit by Brand B merger (%): 0.14476020559469857\nChange in revenue by Brand B merger (%): -0.008575171067045903\n```\n:::\n:::\n\n\n",
    "supporting": [
      "demand_estimation_merger_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}